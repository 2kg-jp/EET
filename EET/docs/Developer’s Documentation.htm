<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Baldur's Gate: Enhanced Edition Trilogy (EET)</title>
	<style type="text/css">/*<![CDATA[*/
    <!-- 
      body {
        margin: 0;
        padding: 0;
        cursor: default;
        text-align: center;
        color: #000;
        background: #e3e3db url('http://athkatla.cob-bg.pl/templates/chilldren/images/aa_tlo4.jpg');
        background-attachment: fixed;
        background-size: cover;
      }
      
      #wrap {
        text-align: left;
        margin: 0 auto;
        margin-top: 20px;
        width: 88%;
        font-family: Verdana, Tahoma, Arial, sans-serif;
        font-size: 12px;
        color: #333;
      }
      
      #header {
        text-align: center;
        background: #e5e5e5;
        border: 1px solid #781808;
        border-top: 5px solid #781808;
        border-bottom: 5px solid #781808;
        padding: 5px 0 13px 0;
      }
      
      #header .about {
        margin: 7px 0 0 0;
        padding: 0;
        font-style: italic;
        color: #555;
      }
      
      #header .menu {
        font-weight: bold;
        margin: 0;
        color: #999;
      }
      
      #header .menu a:link,
      #header .menu a:visited {
        color: #333;
      }
      
      #maindiv {
        margin: 0 auto;
        margin-top: -20px;
        width: 80%;
      }
      
      #maindiv .content {
        counter-increment: kman;
        counter-reset: h2;
        background-color: #e8e8e6;
        padding: 0 0 25px 0;
        margin: 50px auto;
        border-width: 1px 1px 4px 10px;
        border-style: solid;
        border-color: #781808;
        position: relative;
        display: block;
      }
      
      #maindiv .content::before {
        content: counter(kman, lower-roman);
        font-size: 100%;
        font-weight: bold;
        text-align: center;
        color: #eee;
        background-color: #781808;
        width: 35px;
        position: absolute;
        top: 0px;
        left: 0px;
        display: block;
      }
      
      h2 {
        color: #333;
        display: block;
        font-family: Verdana, Trebuchet MS, Arial, serif;
        text-align: left;
        text-indent: 30px;
        padding: 0px;
        margin: 20px 0 0 0;
        border-bottom: dotted 2px #d0d0d0;
        border-top: dotted 2px #d0d0d0;
        background: #deded9;
        font-size: 160%;
      }
      
      h2::first-letter {
        color: #781808;
        background-color: transparent;
      }
      
      #maindiv p {
        color: #333;
        font-size: 100%;
        font-style: normal;
        line-height: 150%;
        padding: 0px;
        margin: 10px auto;
        width: 90%;
        display: block;
        text-align: justify;
      }
      
      #maindiv address a:link,
      #maindiv address a:visited {
        font-weight: bold;
        text-decoration: underline;
        background-color: transparent;
        color: #eaeaea !important;
        padding-right: 5px;
        padding-left: 6px;
      }
      
      #maindiv address a:focus,
      #maindiv address a:hover {
        text-decoration: none;
        color: #F1F1F1;
        border: 0;
      }
      
      #maindiv address a:active {
        color: #fff;
        text-decoration: line-through;
        border: none;
      }
      
      #maindiv address {
        font-size: 95%;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        color: #BBB;
        background-color: #781808;
        padding: 3px 0px 0px;
        margin: 0px;
        width: 100%;
        position: absolute;
        bottom: -1px;
        left: 0px;
        display: block;
        text-align: right;
      }
      
      #maindiv .spoiler {
        font-size: 100%;
        text-indent: 0px;
        font-style: normal;
        line-height: 150%;
        padding: 0px;
        margin: 10px auto;
        margin-right: 5%;
        display: block;
        text-align: justify;
        text-justify: auto;
      }
	  
      #maindiv .important {
        font-size: 95%;
        font-family: Verdana;
        text-align: left;
        background-color: #F1F1F1;
        border-top: solid 1px #aaa;
        border-bottom: solid 1px #aaa;
        border-left: solid 6px #aaa;
        border-right: solid 6px #aaa;
        padding: 10px;
        margin: 20px auto;
        width: 80%;
        line-height: 160%;
      }
      
      #maindiv .important::before {
        display: none;
      }
      
      #maindiv .important p {
        font-size: 100%;
        text-indent: 0px;
        margin: 5px 0 10px 0;
      }
      
      #maindiv ul {
        margin: -10px 0 0 30px;
        *margin-left: 65px;
      }
      
      #maindiv ol {
        margin: -10px 0 0 35px;
        *margin-left: 70px;
      }
      
      #maindiv .important ul {
        margin: -10px 0 0 15px;
      }
      
      #maindiv .important ol {
        margin: -10px 0 0 20px;
      }
      
      #maindiv ul li {
        list-style-type: square;
        line-height: 150%;
        text-align: justify;
        margin-right: 5%;
      }
      
      #maindiv ol li {
        line-height: 150%;
        text-align: justify;
        margin-right: 5%;
      }
      
      .t1 {
        font-weight: bold;
        width: 26%;
        text-align: right;
        clear: right;
        float: left;
        *float: none;
        *margin-left: 65px;
        line-height: 22px;
      }
      
      .t2 {
        text-align: left;
        width: 73%;
        float: right;
        *float: none;
        line-height: 22px;
      }
      
      hr {
        margin: 10px 0 10px 0;
        padding: 0;
        height: 1px;
        border: 0;
        color: #aaa;
        background-color: #aaa;
      }
      
      hr.floatfix {
        clear: both;
        color: #e8e8e6;
        background-color: #e8e8e6;
        *margin: 0;
        *padding: 0;
      }
      
      h1 {
        font-size: 225%;
        color: #444;
        padding: 5px 0 5px 0;
        margin: 0;
        width: 100%;
      }
      
      h3,
      h4,
      h5 {
        margin: 10px 40px 10px 40px;
        padding: 0;
      }
      
      h3 {
        font-size: 125%;
        font-style: italic;
      }
      
      h4 {
        font-size: 125%;
      }
      
      h5 {
        font-size: 100%;
      }
      
      h6 {
        width: 100%;
        margin: 10px 0 15px 0;
        background-color: #ECECEC;
        text-align: left;
        text-indent: 30px;
        font-size: 100%;
        padding-top: 1px;
        padding-bottom: 1px;
        border-bottom: solid 1px #bbb;
        border-top: solid 1px #bbb;
      }
      
      a:link,
      a:visited {
        color: #781808;
        font-weight: bold;
        text-decoration: none;
      }

      a:hover,
      a:active {
        color: #222;
        border-bottom: 1px solid black;
      }

      .tg {
        border-collapse:collapse;
		border-spacing:0;
		margin:0px auto;
      }

      .tg td{
        color: #333;
	    text-align:justify;
        font-family:Verdana, sans-serif;
		font-size:12px;
		padding:10px 5px;
		border-style:solid;
		border-width:1px;
		overflow:hidden;
		word-break:normal;
      }

      .tg th{
        color: #333;
	    text-align:justify;
        font-family:Verdana, sans-serif;
		font-size:12px;
		font-weight:normal;
		padding:10px 5px;
		border-style:solid;
		border-width:1px;
		overflow:hidden;
		word-break:normal;
      }

    -->
    /*]]>*/
	</style>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
</head>
<body>
<a id="top" name="top"></a>

<div id="wrap">
<div id="header">
<h1>Developer's Documentation</h1>
<strong>for Baldur's Gate: Enhanced Edition Trilogy (EET)</strong>

<hr />
<p class="about">Project Lead: K4thos</p>
<p class="about">Contributors: Crevs Daak, WhiteAgnus</p>

<p class="about">
	<a href="http://www.spellholdstudios.net/">Mod Website</a> ·
	<a href="http://www.shsforums.net/">Mod Forum</a> ·
	<a href="https://github.com/K4thos/EET">Source Code</a>
</p>

<hr />
<p class="menu"><a href="#intro">Introduction</a> · <a href="#installation">Installation</a> · <a href="#features">Technical features</a> · <a href="#conventions">EET conventions</a> · <a href="#mods">Creating mods for EET</a> · <a href="#changes">List of changes in vanilla files</a> · <a href="#resources">New resources</a> · <a href="#version">Version History</a></p>
</div>

<div id="maindiv">
<!-- ================== I n t r o d u c t i o n ================== --><a id="intro" name="intro"></a>

<div class="content">
<h2>Introduction</h2>

<p>Baldur’s Gate: Enhanced Edition Trilogy Developers’ Documentation is intended for modders who wish to build modifications to be installed on top of this installation. It is very important that at least some sections of this document be read as it details how exactly the Baldur’s Gate: Enhanced Edition, Siege of Dragonspear and Baldur's Gate 2: Enhanced Edition have been merged together into a seamless Baldur’s Gate: Enhanced Edition Trilogy (EET) game.<br>
<br>
This document is divided into a number of sections to allow quick reference for those who want to know about the installation itself, as well as those more interested in modding for Baldur’s Gate: Enhanced Edition Trilogy.</p>

<address><span class="footer">DEV > Introduction</span> ·<a href="#top">BACK TO TOP</a></address>
</div>
<!-- ================== I n s t a l l a t i o n ================== --><a id="installation" name="installation"></a>

<div class="content">
<h2>Installation</h2>

<p>Unlike Baldur’s Gate Trilogy-WeiDU which comes with pre-made ARE, BCS, DLG, STO and some other files, Baldur’s Gate: Enhanced Edition Trilogy does whole conversion of Baldur’s Gate: Enhanced Edition resources “on the fly” via set of rules explained in the later part of this documentation. Somewhat bloated size of the package is a result of including original BG1 movies converted to 720p (similar outcome to what Beamdog achieved with BG2 movies in Baldur’s Gate II: Enhanced Edition). Other vanilla resources come directly from the Baldur’s Gate: Enhanced Edition and are not part of the installation package. Without going too much into details installation process performs the following steps:</p>
<br>
<ol>
	<li><strong>Installation initialisation</strong> – common variables used during installation are being set, macros and functions defined, BG:EE install directory detected, mods installed on BG:EE compared with EET compatibility list (EET/tbl/compatibility.tbl), BG:EE TLK is converted to TRA format and several other minor things performed.</li>
	<li><strong>BG:EE resources extraction</strong> – during this step all BG:EE files are extracted (unbiffed + copied from override) renamed or deleted if needed and prepared for later biffing and patching. It’s quite lengthy process mostly due to time that is needed to convert TIS v2 (PVRZ based) files to palette based TIS v1 format (needed in order to make BG:EE TIS and WED files dithered water compatible with BG2:EE engine, which expects stencil water).</li>
	<li><strong>BG2:EE files patching</strong> – BG2:EE IDS, TLK, 2DA, CRE, ITM, BCS, DLG, SQL patching (take a look at "EET/lib/bg2_" TPH files and rest of the code in TP2).</li>
	<li><strong>Compatibility patches and dialogue resolving</strong> – files that comes from mods installed on BG:EE are patched if needed to prevent conflicts with BG2:EE. BG:EE DLG files are also patched here to make them compatible with WeiDU compile command and to change hardcoded string numbers into TRA references.</li>
	<li><strong>Conversion</strong> – lengthy process of patching BG:EE resources via macros, using EET naming convention. Files affected (expect ARE and WED files from vanilla BG1 areas, as they have been already patched by tis2bg2 tool in step 2): ARE, BCS, CRE, DLG, EFF, GAM, ITM, SPL, STO, VVC, WED, WMP. For easier debugging each change done in this step is printed during installation with details that shows before->after name, patched offset etc.</li>
	<li><strong>BG:EE files patching and installation</strong> – minor patches made to some BG:EE files if needed and proper installation of the files within BG2:EE. During this step TLK file is dynamically expanded, as each resource that contain string reference now is updated with new value (only strings actually used by these files are added to TLK, so it won’t grow all that much). Graphic resources, WED and WAV files end up being biffed. 2DA, ARE, BCS, CRE, DLG, EFF, ITM, STO, SPL and INI files lands in the override directory.</li>
</ol>
<p>That’s roughly how the installation goes. For more details check EET.TP2 file and rest of the code stored within EET/lib directory.</p>

<address><span class="footer">DEV > Installation</span> ·<a href="#top">BACK TO TOP</a></address>
</div>
<!-- ================== F e a t u r e s ================== --><a id="features" name="features"></a>

<div class="content">
<h2>Technical features</h2>

<p>This section describes various features of Baldur’s Gate: Enhanced Edition Trilogy. Some are tricky, while others are fairly straightforward. For the full picture, it is advised that you peruse through the associated coding and work out intuitively the process by which a particular game feature works, but this section will give you the starting pointers for you to begin to understand how the various technical features have been implemented.</p>

<p><strong>General</strong></p>

<ul>
	<li><a href="#Character continuity between BG1 and SoD">Character continuity between BG1 and SoD</a></li>
	<li><a href="#Character continuity between SoD and BG2">Character continuity between SoD and BG2</a></li>
	<li><a href="#Character continuity between BG2 and ToB">Character continuity between BG2 and ToB</a></li>
	<li><a href="#Dynamic biography">Dynamic biography</a></li>
	<li><a href="#Familiars">Familiars</a></li>
	<li><a href="#Item importation">Item importation</a></li>
	<li><a href="#Item shattering">Item shattering</a></li>
	<li><a href="#Journal system and Chapters">Journal system and Chapters</a></li>
	<li><a href="#Language support">Language support</a></li>
	<li><a href="#Mod support">Mod support</a></li>
	<li><a href="#Random treasure">Random treasure</a></li>
	<li><a href="#Starting the game">Starting the game</a></li>
	<li><a href="#Song reference">Song reference</a></li>
	<li><a href="#Story progression">Story progression</a></li>
	<li><a href="#Visiting old areas">Visiting old areas</a></li>
	<li><a href="#Worldmap">Worldmap</a></li>
</ul>

<hr />
<a id="Character continuity between BG1 and SoD" name="Character continuity between BG1 and SoD"></a>
<h3>Character continuity between BG1 and SoD</h3>
<p>I don’t have access to SoD code and don’t know the story, so the continuity is not implemented yet. One thing is certain – you will continue your journey with characters that you had at the end of BG1. That doesn’t mean that you will have the same party at the end of Siege of Dragonspear. It will depend on how Beamdog implemented the story. If the story doesn’t explain why you end up with canon party at the start of BG2, this aspect will need some more work.</p>

<hr />
<a id="Character continuity between SoD and BG2" name="Character continuity between SoD and BG2"></a>
<h3>Character continuity between SoD and BG2</h3>
<p>Character continuity is handled by K#TELBGT.BCS (local script attached to invisible creature (currently spawned after killing Sarevok, but in future transition will start after finishing SoD expansion). Some characters are not continuous (those without BG2 content) and are disabled immediately, whereas others appear in Shadows of Amn and so continuity is required. Continuity only occurs when a joinable NPC was in your party at any point during BG1 (even if you didn’t had that character in your end party he/she is still valid for transition) and is not dead. A global variable is set to indicate continuity of that NPC, and then the joinable NPC is moved to the appropriate BG2 area where the area script checks the global variable to see if the joinable NPC was imported. If no, the appropriate level of the Shadows of Amn-resident joinable NPC is created, or character doesn’t show up at all, if NPC has been killed during BG1 (except Imoen and Edwin due to plot requirements). During EET installation, continuous joinable BG2 NPCs are replaced by BG1 versions in BALDUR.GAM.</p>

<hr />
<a id="Character continuity between BG2 and ToB" name="Character continuity between BG2 and ToB"></a>
<h3>Character continuity between BG2 and ToB</h3>
<p>Like in vanilla game at the end of BG2 your party migrates to ToB. What has been changed is Fate Spirit old party member summoning mechanics. It no longer spawns new versions of creatures but moves characters from BG2 areas to Pocket Plane via MoveGlobal(). Fate Spirit summoning NPC list is created dynamically depending on who you met during your BG1 and BG2 travels. For continuity sake NPCs that you don’t know won’t even show up on the list. During Fate Spirit dialogue you can receive one of 3 responses to your request:</p>
<ul>
	<li><em><strong>I cannot do as you ask, child of Bhaal. The one you seek is dead and thus forever beyond my reach. This thread no longer connects with yours.</strong></em> – originally used only for Yoshimo, now valid for every NPC that has been killed and left in that state.</li>
	<li><em><strong>I cannot do as you ask, child of Bhaal. The thread of the one you speak is beyond my sight, as it no longer touches yours.</strong></em> – this unused line in vanilla game has been restored to cover BG1 NPCs that don’t have content created in BG2. If you had a character in party at any time during BG1 (true for all NPCs, not only those with BG2 content) but that NPC didn’t join you at least once during BG2 than he/she will show up on the summoning list, but you won’t be able to summon such character.</li>
	<li><em><strong>As you wish.</strong></em> – in such case rest of summoning is handled via AR4500.BCS script. Spawned character is the exact same creature that you left in BG2 (items and other adjustments are preserved, dialogue and script updates are made, if applicable, XP is increased to default starting ToB XP if NPC has less experience).</li>
</ul>

<hr />
<a id="Dynamic biography" name="Dynamic biography"></a>
<h3>Dynamic biography</h3>
<p>The biography at the start of the game is dynamic. Specifically, the biography consists of two paragraphs, the first of which is sensitive to the class of the protagonist, and the second of which is sensitive to the race of the protagonist. Baldur’s Gate II: Enhanced Edition does not support this functionality. To emulate this effect in Baldur’s Gate: Enhanced Edition Trilogy, all possible first and second paragraph combinations are added to dialog.tlk. The code for this can be found in tp2 file. To prevent spoilers by clicking the revert button in the biography screen, the string reference containing the Shadows of Amn biography (#33347) is cleared and move to an unused string reference (#15881). This has the effect of changing the revert button to a second cancel button. Fixing this would require hacking the executable.</p>

<p>When a new character is generated, BG2600.BCS spawns an invisible creature with K#BIO.BCS override script attached, which detects the player’s class and race, and sets the biography accordingly. Setting the biography in this manner overwrites any custom-written biography, so it is important not to set a custom biography until after the biography has been set by script. Finally, a new character generated for a Shadows of Amn game has their biography set accordingly to StrRef #15881, otherwise they would have an empty biography (StrRef #33347).</p>

<hr />
<a id="Familiars" name="Familiars"></a>
<h3>Familiars</h3>
<p>Due to limitations of vanilla familiar mechanics, familiar summoning is now completely scripted and no longer uses hard-coded Find Familiar Spell Effect. After using Find Familiar spell invisible creature (K#FAMSUM) will be spawned to simulate all the benefits and summon appropriate creature based on your character alignment. Familiar creature files have been patched to also summon invisible creature on death that will apply penalties. All is done via spell effects and not scripts, so the solution is very mod friendly. Take a look at <a href="https://github.com/K4thos/EET_Tweaks">EET Tweaks</a> for some examples what changes are now possible thanks to this implementation.</p>

<p>Familiars in BG1 portion of the game uses files from BG:EE, which are far weaker than their equivalents that can be summoned once you reach BG2 and ToB.</p>

<hr />
<a id="Item importation" name="Item importation"></a>
<h3>Item importation</h3>
<p>Transition script also takes care of item importation. In order to record items from the whole party and not only Player1, it need to be done before migrating to Irenicus Dungeon. Before pary is made to lose all inventory using the DropInventory() command, additional code is used to preserve items that should be imported. If the party has a particular item, an invisible creature will take it and return it back to player1 after all inventory is dropped. This way modders can easily add other importable items and implementation itself is fully compatible with code present in Irenicus Dungeon (AR0602.BCS).</p>

<hr />
<a id="Item shattering" name="Item shattering"></a>
<h3>Item shattering</h3>
<p>Item shattering is controlled differently than in BG:EE. Instead of unique spells added to each item type, breakable items now uses common spell to summon invisible creature that will replace the item with braked version if needed (only during BG1). Additionally, by default, Iron Crisis now affects not only normal iron weapons (0.5% chance for each attack in EET, compared to 1% in BG1) but armours (0.2% on hit), shields (0.2%) and helmets (0.1%) too. The effect is true for your party and enemies. It can be considered more a restoration rather than tweak, as from game files it's pretty clear that at least armours and shields were meant to break since they have corresponding flags set and unused icons are present too. If you don't like this feature you can adjust it via <a href="https://github.com/K4thos/EET_Tweaks">EET Tweaks</a> components.</p>

<hr />
<a id="Journal system and Chapters" name="Journal system and Chapters"></a>
<h3>Journal system and Chapters</h3>
<p>Currently during BG1 -> BG2 transition all quest journal entries are removed from the journal. Transition script (K#TELBGT.BCS) reads them directly from SQL file during installation, so it also covers all entries added by mods installed on BG:EE previous to installing EET on BG2:EE.</p>

<p>After patch 1.4 release for BG2:EE above mentioned implementation will be replaced with united journal system that keeps track of all 24 chapters of your journey:</p>
<ul>
	<li><strong>Baldur's Gate</strong></em> – chapters from 0 (prologue) to 7.</li>
	<li><strong>Siege of Dragonspear expansion</strong></em> – chapters from 8 to 14 (instead of 1-7).</li>
	<li><strong>Baldur's Gate II: Shadows of Amn</strong></em> – chapters from 15 to 21 (instead of 1-7).</li>
	<li><strong>Throne of Bhaal expansion</strong></em> – chapters from 22 to 24 (instead of 8-10).</li>
</ul>

<p>Obviously modders interested in creating mods compatible with EET should adopt the newer implementation with continuous journal system.</p>

<hr />
<a id="Language support" name="Language support"></a>
<h3>Language support</h3>
<p>For now EET is available in English, Polish and German. Whole BG:EE portion of the game is dynamically translated using dialog.tlk file exported directly from the BG:EE. There are not many additional lines (just a few KB), so hopefully more languages will be supported soon. Other than this the mod comes with vanilla BG1 movies converted to HD format. If you are interested in helping with translation you can use EET/tra/en_US tra files as a base. If BG1 has been fully localized in your country and you have access to it, send us all MVE files present there and we will convert them to WBM format used in Enhanced Edition engine.</p>

<hr />
<a id="Mod support" name="Mod support"></a>
<h3>Mod support</h3>
<p>As a result of the conversion method explained in first section of this document, EET provides limited support for mods installed on BG:EE previous to installing EET on BG2:EE. Theoretically it could support almost any BG:EE mod with little to no work needed (for example adjusting BG1NPC Project to work with this method required just a few lines of code. Many mods don't need anything changed at all) as the mod resources are treated like vanilla content and patched "on the fly" during EET installation if needed. To ensure that BG:EE mods not intervene with BG2:EE portion of the game EET prevents starting the installation when unrecognised mod is detected. List of supported mods can be found in the <a href="[en_US]readme.htm">EET readme</a> file.
<p>When it comes to mods that alters only BG2 and ToB content than from technical perspective it's very easy to make them compatible. If the mod uses GAME_IS WeiDU command than it should be updated to take into account ~eet~ in the command parameters declaration. After patch 1.4 for BG2:EE, EET will use new continuous journal system that appends BG2 journal numbers instead of going back to number 1, which also need changes in mod code. Both things can be implemented automatically using EET conversion tool as explained <a href="#Detecting EET within WeiDU code">here</a> and <a href="#Adding support for EET chapters/journal system">here</a>, so we hope that at some point most BG2:EE mods will be updated as it's really a matter of minutes. A list of BG2:EE mods that already supports EET will posted in EET release topic - this way compatibility list can be updated frequently without need to re-upload whole mod just to edit the readme file.</p>

<p>Mods designed to affect BG:EE resources or both BG:EE and BG2:EE resources at the same time, installed after EET, should take into account <a href="#convention">naming convention</a> used by this mod. It's recommended to read <a href="#mods">Creating mods for EET</a> section of this document, if you are interested in adding EET native support for your mod.</p>

<hr />
<a id="Random treasure" name="Random treasure"></a>
<h3>Random treasure</h3>
<p>Due to limitations of original RND*.2DA files EET uses new EE <a href="http://gibberlings3.net/forums/index.php?showtopic=27199">engine feature</a> to add BG1 random treasures to the game. RNDTRES.2DA is expanded with all random tables present in vanilla BG:EE. Name of the dummy files used as random loot reference remains mostly unchanged – the only difference is added "_" at the end of filename (standard EET naming convention for conflicting resources) and due to 8 characters limit "0" has been dropped (this is standard <a href="#Resource naming convention">EET naming convention</a> for 8 letters conflicting resources). Read the linked information about this functionality and open up RNDTRES.2DA modified by EET to see how exactly it works.</p>

<hr />
<a id="Starting the game" name="Starting the game"></a>
<h3>Starting the game</h3>
<p>As a result of GUI limitations (max 3 game slots, disabled worldmap during BP campaign, hardcoded button that points to ToB, which uses different global script) EET currently uses rather awkward way to start the game.</p>
<ul>
	<li>Baldur's Gate - first icon in main menu (choosing this option allows you to play whole saga from start to finish - BG1, TotSC, Siege of Dragonspear (not yet), BG2:SoA, BG2: ToB)</li>
	<li>Baldur's Gate II: Throne of Bhaal - second icon in main menu</li>
	<li>Black Pits II: Gladiators of Thay - third icon in main menu</li>
	<li>Black Pits - start Black Pits II and choose new dialogue response during the first conversation in tavern: "You can tell a ballad with more subtleties and nuances if you have experienced something first hand. Listen to my story." (after finishing Black Pits portion you will again end up in Black Pits 2 tavern, so you can continue this adventure with the same party.)</li>
	<li>Baldur's Gate II: Shadows of Amn - start Baldur's Gate, equip a book (darker one) that has been added to your inventory and use it in game (your character will receive missing XP if it's below 95k and Bhaal powers. Mages will automatically receive memorized spells appropriate to BG2 starting level, in the same way as if you would choose "pick for me" during character generation)</li>
	<li>Tutorial - start Baldur's Gate, equip a book (brighter one) that has been added to your inventory and use it in game.</li>
</ul>

<hr />
<a id="Song reference" name="Song reference"></a>
<h3>Song reference</h3>
<p>EET uses all music files present in BG:EE and BG2:EE. The mod is meant to be installed on clean installation of BG2:EE, which allows it to set a common standard for song numbers for mods installed later. All BG2:EE song references are kept as they were, BG:EE songs that were missing in BG2:EE become appended to songlist.2da during EET installation. Use this new songlist.2da as a reference if your mod is designed to use music missing in vanilla BG2:EE release. It's also easy to patch areas from BG:EE and BGT mods to use EET common standard for song numbers thanks to <a href="../other/EET_modConverter">EET_modConverter</a> tool, as has been explained <a href="#Adopting EET naming conventions for BG1 resources">here</a>.</p>

<hr />
<a id="Story progression" name="Story progression"></a>
<h3>Story progression</h3>
<p>You start the game in Candlekeep and continue the BG1 storyline up until defeating Sarevok. Instead of end credits you can continue playing. After returning to Baldur’s Gate, Siege Of Dragonspear expansion starts seamlessly and allows you to experience new questline up until the party is captured by Irenicus (or at least that is how we hope Siege Of Dragonspear ends). After that you end up in Irenicus Dungeon. In current version access to BG1 areas during BG2 is blocked until you reach chapter 7 (entering Suldanessellar for the first time), but after patch 1.4 release you will be able to travel back as soon as chapter 2 starts. Nothing changes on how ToB expansion progress. The only difference is that you have free access to previously visited areas as soon as you leave Saradush.</p>

<hr />
<a id="Visiting old areas" name="Visiting old areas"></a>
<h3>Visiting old areas</h3>
<p>This feature has been implemented via BG000.ARE area that have links connecting it with BG1 and BG2 areas. The area itself doesn’t have icon on map. At the time you visit it as a "random" (not really) area encounter during BG1, game establishes these new connections between areas. When you leave it the area becomes hidden via HideAreaOnMap action and later reviled in BG2 portion of the game, which restores connections between BG1 and BG2 areas. As for ToB, all areas are already connected with each other via Watcher's Keep. The same WMP file is used during whole game, so previously visited areas are not removed even after starting ToB. Keep in mind that links between areas are established dynamically during your play through so player won’t be able to come back to BG1 areas if he/she started the game in BG2, or to BG2 and BG1 areas if the game was started in ToB while skipping rest of the story. Visiting all old areas is a feature only for players that play whole story, from start to finish.</p>

<p>EET handles things that doesn't make sense story or content wise by either adding <a href="#Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB">additional filtering</a> via global variable (this way topics regarding iron crisis doesn't show up when you visit these areas in BG2/ToB, tavern rumours won't mention irrelevant events etc.) or by removing creatures from areas after certain point (for example BG1 NPCs without additional story for BG2 portion of the game won't show up when you visit the BG1 area where you left them. Same for Iron Throne antagonists etc.)</p>
</p>

<hr />
<a id="Worldmap" name="Worldmap"></a>
<h3>Worldmap</h3>
<p>EET is fully compatible with BP-BGT Worldmap mod (refer to that mod documentation to understand how to work with it), so mods that are dependent on it can still work with EET. Additionally EET comes with its own unique worldmap that covers all supported games (Siege of Dragonspear is not supported yet).</p>

<p>Whole game is using a single worldmap that doesn't change even in ToB (new EE command is used to change it back from WORLDM25.WMP to WORLDMAP.WMP, so none of your explored area flags are lost). To make modders life easier the map itself is basically BG1, BG2, ToB maps merged together and edited to fill blank areas in BG2 map style.</p>

<p>WMP file is generated on the fly during installation, using areas, links and strings exported directly from vanilla BG:EE and BG2:EE maps. Keep in mind that coordinates for BG:EE areas are provided externally (EET/tbl/map_bgee_areas.tbl) due to changes that Beamdog introduced in BG:EE map size and locations (for better compatibility with mods, values are taken from original BG1/Tutu worldmap).</p>

<address><span class="footer">DEV > Technical features</span> ·<a href="#top">BACK TO TOP</a></address>
</div>

<!-- ================== C o n v e n t i o n s ================== --><a id="conventions" name="conventions"></a>

<div class="content">
<h2>EET conventions</h2>

<p><strong>General</strong></p>

<ul>
	<li><a href="#Areas naming convention">Areas naming convention</a></li>
	<li><a href="#Resource naming convention">Resource naming convention</a></li>
	<li><a href="#NPC Join/Post/Banter files">NPC Join/Post/Banter files</a></li>
	<li><a href="#Naming convention for new files">Naming convention for new files</a></li>
	<li><a href="#BG1 resource naming reference table">BG1 resource naming reference table</a></li>
</ul>

<hr />
<a id="Areas naming convention" name="Areas naming convention"></a>
<h3>Areas naming convention</h3>
<p>All area resources have been renamed to have new area codes because there is considerable overlap in area filenames between Baldur’s Gate: Enahanced Edition and Baldur’s Gate II: Enhanced Edition. It is a straightforward system of renaming all resources related to area (ARE, WED, TIS, MOS, BMP, BCS). The numbers are untouched, but the prefix "AR" is changed to "BG". This maintains the consistency and validity of area references from a number of public documents, including walkthroughs, travel maps, and the like. Therefore, these documents can be referred to for an area number guide to EET, except that the prefix change from "AR" to "BG" must be considered when, for example, using the CLUAConsole, or when developing modifications that affects Baldur’s Gate: Enhanced Edition areas.</p>

<hr />
<a id="Resource naming convention" name="Resource naming convention"></a>
<h3>Resource naming convention</h3>
<p>For other resources, EET keeps the original BG:EE resource name as strictly as possible. If it doesn’t conflict with BG2:EE content than the name of imported file is not changed. For conflicting resources BG1 ones have suffix with the underscore (_) added to make them unique. Since the engine only supports 8.3 filenames, 8-character resources from BG1 have "0" character removed if replacing the last character would result in overlapping resource names - only 2 cre files: skelwa02.cre => skelwa2_.cre, skelwa03.cre => skelwa3_.cre, also used for <a href="#Random treasure">random item tables</a> (example: RNDWEP01 => RNDWEP1_).</p>

<p>Conflicting spells from BG:EE uses a little different naming convention - "BG" letters replaces first 2 letters of the spell (so SPWI becomes BGWI etc). The reason behind this is limitation of the engine which expects maximum 7 character spell names for some spell effects. This convention adopted from BGT makes the rename spells still easy to identify.</p>

<hr />
<a id="NPC Join/Post/Banter files" name="NPC Join/Post/Banter files"></a>
<h3>NPC Join/Post/Banter files</h3>
<p>Unlike BGT, Join (file that has all NPC normal dialogues) and Post (conversation when NPC is leaving the party) dialogue files are NOT appended with BG2 counterparts. They use standard EET renaming convention (underscore suffix) to prevent conflicts with BG2 files (only implemented for Dorn, Edwin, Imoen, Jaheira, Minsc, Neera, Rasaad, Viconia because other NPCs don’t use conflicting dialogue files). This approach allows modders to write/edit NPC dialogues without worrying about conflicts between games and eliminates a problem with finding correct dialogue block numbers within the file. Additional code has been added to NPC override script, that <a href="#Workaround for PDIALOG.2DA forced dialogues">forces dialogue change</a> during BG1 portion of the game, instead of using the one assigned via PDIALOG.2DA.</p>

<p>Only BANTER dialogues are appended to BG2 files (engine limitation). During installation banter files are patched to add proper filtering between games. EET determines what state number will be the first state of the Baldur’s Gate: Enhanced Edition banter dialogue for these conflicting, appended files, and stores that inside variables contained in EET\FluidStates.tpa. Other states of the BG:EE dialogue can be calculated relative to the state number representing the first state. The .tpa file can be utilised simply by using the WeiDU function INCLUDE (it's automatically included if you use EET <a href="#Adding support for EET chapters/journal system">cpmvars</a>).</p>

<hr />
<a id="Naming convention for new files" name="Naming convention for new files"></a>
<h3>Naming convention for new files</h3>
<p>New files added by EET have "K#" prefix to distinguish them from vanilla BG:EE and BG2:EE content. List of new resources can be found in <a href="#resources">this section</a>.</p>

<hr />
<a id="BG1 resource naming reference table" name="BG1 resource naming reference table"></a>
<h3>BG1 resource naming reference table</h3>
<p>For more convenient viewing, the BG1 resource naming reference table has been moved to <a href="BG1 reference table.htm">external file</a>. Even though it's in HTML format it's basically a spreadsheet file, so you can also open it for example in Microsoft Excel (which has been used to create it). The file is separated into several worksheets named after extensions of files listed there. Columns show naming conventions used in BG:EE, EET and BGT. Tutu reference has not been included because it renames pretty much every single resource in game which would bloat the table.</p>

<address><span class="footer">DEV > EET conventions</span> ·<a href="#top">BACK TO TOP</a></address>
</div>

<!-- ================== M o d s ================== --><a id="mods" name="mods"></a>

<div class="content">
<h2>Creating mods for EET</h2>

<p><strong>General</strong></p>

<ul>
	<li><a href="#Adopting EET naming conventions for BG1 resources">Adopting EET naming conventions for BG1 resources</a></li>
	<li><a href="#Adding support for EET chapters/journal system">Adding support for EET chapters/journal system</a></li>
	<li><a href="#Detecting EET within WeiDU code">Detecting EET within WeiDU code</a></li>
	<li><a href="#Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB">Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB</a></li>
	<li><a href="#Adding AreaType to BG1 ARE files">Adding AreaType to BG1 ARE files</a></li>
	<li><a href="#Detecting mods installed on BG:EE">Detecting mods installed on BG:EE</a></li>
	<li><a href="#Adding support for mods installable on BG:EE previous to installing EET on BG2:EE">Adding support for mods installable on BG:EE previous to installing EET on BG2:EE</a></li>
	<li><a href="#Adding support for shattering items (iron crisis) system in BG1 portion of the game">Adding support for shattering items (iron crisis) system in BG1 portion of the game</a></li>
	<li><a href="#Importing more items to BG2">Importing more items to BG2</a></li>
	<li><a href="#Adding support for NPC transition system">Adding support for NPC transition system</a></li>
	<li><a href="#Workaround for PDIALOG.2DA forced dialogues">Workaround for PDIALOG.2DA forced dialogues</a></li>
	<li><a href="#Workaround for CalanderDay command in SoD/BG2 portion of the game">Workaround for CalanderDay command in SoD/BG2 portion of the game</a></li>
	<li><a href="#Adding new animations">Adding new animations</a></li>
	<li><a href="#Adding support for EET Worldmap">Adding support for EET Worldmap</a></li>
</ul>

<hr />
<a id="Adopting EET naming conventions for BG1 resources" name="Adopting EET naming conventions for BG1 resources"></a>
<h3>Adopting EET naming conventions for BG1 resources</h3>
<p>If your mod is designed to work not only with EET but also other platforms you should consider using either:</p>
<ul>
<li><a href="../other/cpmvars">cpmvars variable libraries</a> - a set of variable declaration for BG:EE/BGT/Tutu/EET. INCLUDE each of these TPA files using GAME_IS WeiDU command, depending on each platform. These will cover all area names, area scripts, NPC dialogue and some other differences, allowing you to code everything with the same WeiDU code (by replacing resource name with variable). If some resource is not implemented here you can expand it to cover all your needs. It's a well known way of coding, with plenty of examples in released mods, so let's focus only on new additions related to EET.<br>
- <strong>eet_var</strong> - used to add EET "_" suffix at the end of files. Other platforms will return nothing for it, so the letter is added only for EET.<br>
- <strong>eet_script0</strong> - used to remove "0" in conflicting resources with 8 letters (SKELWA02.CRE => SKELWA2_.CRE, SKELWA03.CRE => SKELWA3_.CRE, also used for random item tables (RNDEQU / RNDMAG / RNDSCR / RNDTRE / RNDWEP - example: RNDWEP01 => RNDWEP1_). Other platforms will return "0" for it and EET cpmvars will return nothing (symbol is removed). You still need to use %eet_var% a the end to add "_" symbol.<br>
These 2 variables can be used to properly reference BG1 resources in code that are not already handled by existing cpmvars. Take a look at <a href="#conventions">EET conventions</a> section if you have problem understanding why exactly these variables are handy.<br>
- <strong>BGT_VAR</strong> - not exactly new addition (it already existed with the same purpose for BGT) but still very important for EET. It can be used as trigger filter to shutdown of D and BAF blocks after BG1 content. It adds following trigger: GlobalLT("ENDOFBG1","GLOBAL",2). <a href="#Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB">Content filtering</a> is explained in later part of this document (consider adding more filtering variables to your copy of cpmvars if you need them).<br>
- <strong>sod_chapter_1-7, bg2_chapter_1-10</strong> - variables that should replace SoD/BG2 chapter numbers in your code. More information in <a href="#Adding support for EET chapters/journal system">this section</a>.<br>
- <strong>wmp_xCoord_BG1, wmp_yCoord_BG1, wmp_xCoord_SoA, wmp_yCoord_SoA, wmp_mapIcon_BG1, wmp_mapIcon_ToB, wmp_worldmap_ToB</strong> - a bunch of variables that can be used to properly patch EET Worldmap with the same code as in other platforms. They have been explained in <a href="#Adding support for EET Worldmap">this section</a>.</li>
<li><a href="https://github.com/FredrikLindgren/bg1pal">BG1 Platform-Abstraction Layer (BG1PAL)</a> - a resource-name abstraction library for the different versions of Baldur's Gate. It converts canonical resource names into the appropriate form for the current platform via the function fl#bg1pal, which is available both as an action and a patch function. All resource names and resource types are supported. The input name is the one from BG1/BG:EE. For more extensive documentation, please refer to the file readme.html distributed with this resource.</li>
</ul>

<p>You can also patch files directly using <a href="../other/EET_modConverter">EET_modConverter</a> tool that has custom version of Platform Conversion Utility in it, specialized in converting BG:EE and BGT code and resources to adopt EET naming convention. The tool will print all changes it makes into the log file, so you can review them if they are really needed. "Patching (...)" in log means that the input file has been patched and has been copied to output directory of the tool. "Analyzing (...)" means that the tool found an instance of the resource in tp2/tph/tpp/tpa files that didn't have extension provided. In such case the file is not patched but you should manually check if suggested change is warranted. Keep in mind that PCU part of this tool is designed for mods with BG1/BG:EE content only. You should not use it for mods with BG2 resources/code, unless you really know you're doing. Supported files that this tool can automatically convert: TBL, GAM, ARE, BAF, BCS, CRE, D, DLG, EFF, ITM, SPL, STO, TRA, TP2, TPH, TPP, TPA, VVC, WED, WMP. Other than renaming and patching files to use EET naming convention it will also handle converting ARE Song references to use EET song playlist.</p>

<hr />
<a id="Adding support for EET chapters/journal system" name="Adding support for EET chapters/journal system"></a>
<h3>Adding support for EET chapters/journal system</h3>
<p>As explained in <a href="#Journal system and Chapters">this section</a> after patch 1.4 for BG2:EE, EET will use continuous journal/chapters system through whole game instead of resetting them over after each campaign. Sounds like a nightmare compatibility wise, right? Well... not really. All changes to your code can be implemented automatically without any effort on your part. There are 2 ways do it:</p>
<ul>
<li><a href="../other/EET_modConverter">EET_modConverter</a> - this tool can be used to automatically convert any SoD, BG2 and ToB code to use cpmvars like system for chapters. It will patch all BAF, D, TP2, TPH, TPP, TPA files to use variables instead of numbers whenever SetGlobal, Global, GlobalGT, GlobalLT related to chapter number is used in your code. Variable declaration depending on platform will be also automatically added to ALWAYS section of tp2 file (you can remove this additional code if you already use <a href="../other/cpmvars">cpmvars</a> variable libraries).</li>
<li><a href="../other/EET_functions">EET_functions.tph</a> - this file contains several functions related to EET compatibility patching. Among other things it contains an action function called EET_JOURNAL which can be used in your code to patch files designed for other platforms on the fly during mod installation. Here is example how it's meant to be used:</li>
</ul>

<div class="important">
<pre>
ACTION_DEFINE_ARRAY arrayName BEGIN ~modDir/AERIE.d~ ~%var%/ALARM25.baf~ ~modDir/code.tph~ ~override/AERIE.bcs~ END
LAF ~EET_JOURNAL~
  INT_VAR
    journal_game = 1 //0 - BG2 (current chapter value + 14); 1 - SoD (current chapter value + 7) (default = 0)
    journal_patch_mode = 1 //0 - replace with values; 1 - replace with variables (default = 0)
  STR_VAR
    journal_array = EVAL ~arrayName~ //array with files to patch (supports: d, dlg, baf, bcs, and any text file with code)
END
</pre>
</div>

<div class="important">
<strong>Even though the current publicly available version of EET doesn't use new journal/chapters system yet, you should already convert your code to support it. EET_JOURNAL function, cpmvars and EET_modConverter, checks if the EET_JOURNAL text is present within EET.flag and sets variable values accordingly, making the code compatible with both current and future version of EET.</strong>
</div>

<hr />
<a id="Detecting EET within WeiDU code" name="Detecting EET within WeiDU code"></a>
<h3>Detecting EET within WeiDU code</h3>

<ul>
<li>There is a new WeiDU parameter used with GAME_IS command for EET detection: <strong>GAME_IS ~eet~</strong></li>
<li>EET is also detectable with: <strong>ENGINE_IS ~bg2ee~</strong> and <strong>GAME_INCLUDES ~bg2~</strong> and/or <strong>~soa~</strong> and/or <strong>~tob~</strong></li>
</ul>

<p>Once again <a href="../other/EET_modConverter">EET_modConverter</a> may be handy if you need to replace many instances of GAME_IS command in your code, as the tool has an option to do it automatically.</p>

<hr />
<a id="Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB" name="Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB"></a>
<h3>Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB</h3>
<p>EET uses following GLOBAL in-game variable filters for vanilla campaigns to shut off content that no longer should show up after certain point of the story.</p>
<ul>
<li><strong>CHAPTER</strong> - that's an obvious way to handle things. Unlike BGT, EET will soon use continuous journal/chapter system, so the game will consist of 24 chapters in total. You can use this variable reliably for this purpose (after patch 1.4 is released for BG2:EE).</li>
<li><strong>ENDOFBG1</strong> - variable will return 1 right after you kill Sarevok. It is set to 2 after Siege of Dragonspear -> Shadows of Amn transition. In other words you can use it to filter content designed only for BG:EE part of the story (or only for BG2 if you assigned the trigger to check if the result is 2).</li>
<li><strong>ENDOFBG2</strong> - variable is set to 2 in the first area of Throne of Bhaal expansion (AR4000.BCS)</li>
</ul>
<p>ENDOFBG1 and ENDOFBG2 variables are correctly set even if you start the game in BG2 or ToB, so they should be always reliable for content filtering.</p>

<p>There may be situations where you want to filter content to show up (or not) when party is returning to old areas. For this purpose EET added new "BG1AREA" entry to AREATYPE.IDS. You can check if the current area is part of BG1 campaign via following triggers:</p>
<ul>
<li><strong>AreaType(BG1AREA)</strong> - returns true only if the active CRE is in one of the BG1/SoD areas (areas added by mods located on BG1 landmass also should be patched to use it).</li>
<li><strong>!AreaType(BG1AREA)</strong> - returns true only if the active CRE is NOT in one of the BG1/SoD areas (which means BG2/ToB or far away lands added by mods).</li>
</ul>
<p>If you need more precision with detecting areas you can also use additional AreaCheck(S:ResRef*) triggers.</p>

<hr />
<a id="Adding AreaType to BG1 ARE files" name="Adding AreaType to BG1 ARE files"></a>
<h3>Adding AreaType to BG1 ARE files</h3>
<p>Either patch area with this WeiDU code during your mod installation:</p>
<div class="important">
<pre>
WRITE_SHORT 0x48 THIS | (1 << BG1AREA)
</pre>
</div>

<p>Or use pre-made EET_AREATYPE action function, available within <a href="../other/EET_functions">EET_functions.tph</a>, that will do it on the fly for all areas listed in array:</p>
<div class="important">
<pre>
ACTION_DEFINE_ARRAY arrayName BEGIN ~modDir/name.are~ ~%var%/name.are~ ~override/name.are~ END
LAF ~EET_AREATYPE~
  STR_VAR
    areatype_array = EVAL ~arrayName~ //array with ARE files to patch
END
</pre>
</div>

<hr />
<a id="Detecting mods installed on BG:EE" name="Detecting mods installed on BG:EE"></a>
<h3>Detecting mods installed on BG:EE</h3>

<p>EET has <a href="#Mod support">limited support for BG:EE mods installed on BG:EE</a> previous to installing EET on BG2:EE. Mods installed this way are treated exactly the same as vanilla resources and end up part of the BG2:EE EET installation. So, how can other mods detect if a particular mod has been installed on BG:EE? There are 2 ways to do it:</p>

<ul>
<li><strong>dummy files</strong> are often used by mods to make them detectable by other mods. They are copied to EET override directory during installation, so can be normally detected via FILE_EXISTS_IN_GAME WeiDU command.</li>
<li><strong>WeiDU.log file</strong> from BG:EE is copied to EET override directory which allows modders to use workarounds for existing WeiDU functions. Here are few examples using BG1 NPC Project component 0, any language:</li>
</ul>

<div class="important">
<pre>
//works the same as REQUIRE_COMPONENT
REQUIRE_PREDICATE ((FILE_EXISTS ~override/WeiDU.log~) AND (FILE_CONTAINS ~override/WeiDU.log~ ~BG1NPC\.TP2. #[0-9]+ #0 ~)) ~~

//works the same as FORBID_COMPONENT
REQUIRE_PREDICATE ((!FILE_EXISTS ~override/WeiDU.log~) OR (!FILE_CONTAINS ~override/WeiDU.log~ ~BG1NPC\.TP2. #[0-9]+ #0 ~)) ~~

//works the same as MOD_IS_INSTALLED
ACTION_IF (FILE_EXISTS ~override/WeiDU.log~) AND (FILE_CONTAINS ~override/WeiDU.log~ ~BG1NPC\.TP2. #[0-9]+ #0 ~) BEGIN
    //do something if component has been detected
END ELSE BEGIN
    //do something if component has NOT been detected
END
</pre>
</div>

<ul>
	<p>Of course if your mod is meant to also detect the mod installed natively than you should nest above mentioned code with vanilla WeiDU commands used for mod detection.</p>
	<p>Overall this workaround doesn't sound like a very useful thing because BG:EE mods usually don't affect BG2:EE content, so the need for additional check for them in BG2:EE mods is not common. The ones affected are usually installed on BG:EE too, so any WeiDU mod detection command works correctly at that time. And the more complicated mods (such as BG1 NPC Project) already uses dummy files, so they are detectable without any hassle anyway.</p>
</ul>

<hr />
<a id="Adding support for mods installable on BG:EE previous to installing EET on BG2:EE" name="Adding support for mods installable on BG:EE previous to installing EET on BG2:EE"></a>
<h3>Adding support for mods installable on BG:EE previous to installing EET on BG2:EE</h3>
<p>If you're not planning to convert your BG:EE mod to work natively with EET, you may be interested in a solution that treats mods installed on BG:EE (previous to installing EET on BG2:EE) as vanilla content, which means all new BG:EE resources are converted on the fly with vanilla files. For more information how to achieve this please take a look at <a href="../other/BGEE_to_EET_mod_checker">BGEE_to_EET_mod_checker</a> tool readme file.</p>

<hr />
<a id="Adding support for shattering items (iron crisis) system in BG1 portion of the game" name="Adding support for shattering items (iron crisis) system in BG1 portion of the game"></a>
<h3>Adding support for shattering items (iron crisis) system in BG1 portion of the game</h3>
<p>Patch items that you want to add into iron crisis shattering pool with following action function, available within <a href="../other/EET_functions">EET_functions.tph</a>. It will remove BG:EE/Tutu/BGT/EET implementation (if already present) and add <a href="#Item shattering">EET item shattering system</a> to weapons, armors, shield and helmets listed in the array.</p>

<div class="important">
<pre>
ACTION_DEFINE_ARRAY arrayName BEGIN ~modDir/weapon.itm~ ~modDir/armor.itm~ ~%var%/shield.itm~ ~override/helmet.itm~ END
LAF ~EET_IRON_CRISIS~
  STR_VAR
    shattering_array = EVAL ~arrayName~ //array with files to patch (supports: weapons, armors, shields, helmets)
END
</pre>
</div>

<hr />
<a id="Importing more items to BG2" name="Importing more items to BG2"></a>
<h3>Importing more items to BG2</h3>
<p>As explained in <a href="#Item importation">Item importation</a> description it's easy to import more items to BG2, using the same AR0602.BCS code that works in vanilla BG2. All you need to do is:</p>

<ul>
	<li><strong>REPLACE_TEXTUALLY K#TELBGT.BCS</strong> to add additional items into existing block in EET transition script, for example:</li>
</ul>

<div class="important">
<pre>
COPY_EXISTING ~K#TELBGT.BCS~ ~override~
  REPLACE_TEXTUALLY ~SetGlobal("K#DoOnceItemList","LOCALS",1)~ ~SetGlobal("K#DoOnceItemList","LOCALS",1)
    TakePartyItem("MISC47") // Golden Pantaloons
    TakePartyItem("CHAN06") // Mithral Chain Mail +4
    TakePartyItem("SW1H15") // Icingdeath +3
    TakePartyItem("SW1H16") // Twinkle +3~
</pre>
</div>

<ul>
	<li>Alternatively you could <strong>EXTEND_TOP K#TELBGT.BCS</strong> with the code that will preserve items during transition. Here are few examples:</li>
</ul>

<div class="important">
<pre>
//setting global variable if party had particular item
IF
  Global("BG1DrizztItem","GLOBAL",0)
  OR(3)
    PartyHasItem("CHAN06") // Mithral Chain Mail +4
    PartyHasItem("SW1H15") // Icingdeath +3
    PartyHasItem("SW1H16") // Twinkle +3
THEN
  RESPONSE #100
    SetGlobal("BG1DrizztItem","GLOBAL",1)
    Continue()
END

//this code will ensure that CHARNAME will start BG2 with this item (so code in AR0602.BCS will be able to check it)
IF
  PartyHasItem("MISC47") // Golden Pantaloons
THEN
  RESPONSE #100
    TakePartyItem("MISC47") // Golden Pantaloons
    Continue()
END

//as above but saves the item using TakeItemListPartyNum action (in EE engine you can use any 2da file with this action)
IF
  Global("variableNameOfYourChoice","LOCALS",0)
THEN
  RESPONSE #100
    SetGlobal("variableNameOfYourChoice","LOCALS",1)
    TakeItemListPartyNum("IMPORT02",1)
    TakeItemListPartyNum("IMPORT01",1)
    TakeItemListPartyNum("IMPORT03",1)
    Continue()
END
</pre>
</div>

<p>And so forth. As long as the dummy K#TELBGT.CRE, that has transition script attached to it, will get the item from the party, you will end up with it in BG2 (CRE returns all acquired items once the party drop all inventory).</p>

<hr />
<a id="Adding support for NPC transition system" name="Adding support for NPC transition system"></a>
<h3>Adding support for NPC transition system</h3>
<p>As <a href="#Character continuity between BG1 and SoD">already explained</a> EET uses new system for NPC transition from Siege of Dragonspear expansion to Shadows of Amn (currently transition starts after killing Sarevok, but it will be changed once SoD support is implemented) and from Shadows of Amn to Throne of Bhaal expansion. In order to make modder's life easier we've prepared a function designed to automatically add both types of transition to any kind of NPC mod. All you need to do to make your NPC fully compatible with EET is disabling your normal patching code for AR4000.BCS, AR4500.BCS, FATESP.DLG and using EET_TRANSITION function instead.</p>
<p>If your BG2 NPC is meant to have BG1->BG2 transition than you should add additional <strong>Global("%dv%PartyBG1","GLOBAL",0)</strong> trigger (where %DV% is death variable of your CRE) in the code that spawns new version of CRE file into BG2 area. This way such block won't trigger if the NPC is valid for migration from BG1 to BG2. For example:</p>

<div class="important">
<pre>
//this code will spawn new version of CRE if the transition didn't occur and CRE was not left dead in BG1
IF
  Global("MinscImport","MYAREA",0)
  Global("MinscPartyBG1","GLOBAL",0)
  !Dead("Minsc")
  LevelGT(Player1,11)
THEN
  RESPONSE #100
    CreateCreature("Minsc12",[4029.2759],6)
    SetGlobal("MinscImport","MYAREA",1)
    Continue()
END
</pre>
</div>

<p>You can optionally specify SoA transition script in the function explained below. The script can be used to make some adjustments for BG2 portion of the game if needed. It is assigned to OVERRIDE script slot during transition and triggers as soon as you visit BG2 area where your NPC has been moved. Don't forget to replace the OVERRIDE script with the correct one at the end of the this transition script. For example:</p>

<div class="important">
<pre>
IF
  Global("ImoenImport","MYAREA",0) //use GLOBAL/LOCALS/AREA variable just to be sure that block will be true only once
  LevelLT(Protagonist,13)
  XPLT(Myself,400000)
THEN
  RESPONSE #100
    ChangeStat(Myself,XP,400000,SET)
    Continue()
END

IF
  Global("ImoenImport","MYAREA",0)
  LevelGT(Protagonist,12)
  XPLT(Myself,1200000)
THEN
  RESPONSE #100
    ChangeStat(Myself,XP,1200000,SET)
    Continue()
END

IF
  Global("ImoenImport","MYAREA",0)
THEN
  RESPONSE #100
    SetGlobal("ImoenImport","MYAREA",1)
    DestroyItem("IMOENHP1")
    CreateItem("STAF01",1,0,0)
    CreateItem("CLCK14",1,0,0)
    FillSlot(SLOT_ARMOR)
    FillSlot(SLOT_WEAPON)
    EquipMostDamagingMelee()
    SetPlayerSound(Myself,30759,MORALE)
    SetDialog("IMOEN10")
    SetNumTimesTalkedTo(0)
    SetGlobal("K#PDIALOG","LOCALS",0)
    SetGlobal("KickedOut","LOCALS",0)
    ChangeAIScript("NPCMAGE1",CLASS)
    ChangeAIScript("",RACE)
    ChangeAIScript("IMOEN",OVERRIDE) //this one will end the script
END
</pre>
</div>

<p>Copy <a href="../other/EET_functions">EET_functions.tph</a> to your mod folder and use INCLUDE command to properly declare these new functions. You can use this example code for reference how the function is meant to be used:</p>

<div class="important">
<pre>
LAF ~EET_NPC_TRANSITION~
  INT_VAR
    type = 1
      //1 - BG1 NPC without BG2 content (NPC is disabled from game during SoA transition, mentioned but not summonable in ToB)
      //2 - BG2 NPC without BG1 content (transition to ToB if joined the party at least once during SoA)
      //3 - NPC with BG1 and BG2 content (full transition to SoA/ToB)
    posX = 3198 //NPC X coordinate on SoA transition destination ARE
    posY = 2837 //NPC Y coordinate on SoA transition destination ARE
    face = 6 //NPC facing on SoA transition destination ARE
    create_SoA = 0 //controls if new CRE should be spawned in SoA if NPC was killed in BG1 (no by default - 0)
    default_ToB = 0 //controls if NPC should be spawnable in ToB when the game has been started in ToB (no by default - 0)
  STR_VAR
    dv = "IMOEN2" //Death Variable (script name) of the NPC (must be the same in BG1/SoD/BG2/ToB)
    are = "AR0602" //ARE file name where NPC should be moved during SoA transition
    transition_SoA = "" //script assigned to override slot during transition, should be manually replaced with override_SoA
    override_BG1 = "IMOEN_" //name of the override NPC script in BG1
    override_SoA = "IMOEN2" //name of the override NPC script in SoA
    override_ToB = "IMOEN25" //name of the override NPC script in ToB
    dialog_ToB = "IMOEN25A" //name of the dialogue file used after spawning NPC in ToB
    string = "@1" //FATESP summon text (example: "Bring me Quayle, the gnome cleric/illusionist.") or TRA string number
    stringPosDV = "" //set the DV of NPC right below your response (used for sorting FATESP responses alphabetically)
      //Aerie, Ajantis, Alora, Anomen, Baeloth, Branwen, Cernd, Coran, Dorn, Dynaheir, Edwin, Eldoth, Faldorn, Garrick
      //HaerDalis, Hexxat, Imoen2, Jaheira, Jan, Kagain, Keldorn, Khalid, Kivan, Korgan, Mazzy, Minsc, Montaron, Nalia
      //Neera, Quayle, Rasaad, Safana, SharTeel, Skie, Tiax, Viconia, Valygar, Wilson, Xan, Xzar, Yeslick, Yoshimo
      //variable not set (default) = NPC name appended at the end of summoning list
    SummonedVar = "" //set it only if you want to use different var name than %dv%Summoned (useless in most cases)
    SpawnPlaneVar = "" //set it only if you want use different var name than %dv%SpawnPlane (useless in most cases)
END
</pre>
</div>

<div class="important">
<pre>
//BG1 NPC without BG2 content
LAF ~EET_NPC_TRANSITION~
  INT_VAR
    type = 1
  STR_VAR
    dv = "IMOEN2"
    override_BG1 = "IMOEN_"
    string = "@1"
END

//BG2 NPC without BG1 content
LAF ~EET_NPC_TRANSITION~
  INT_VAR
    type = 2
  STR_VAR
    dv = "IMOEN2"
    override_SoA = "IMOEN2"
    override_ToB = "IMOEN25"
    dialog_ToB = "IMOEN25A"
    string = "@1"
END

//NPC with BG1 and BG2 content (type = 3 can be also used to add transition into vanilla BG1 NPC without it)
LAF ~EET_NPC_TRANSITION~
  INT_VAR
    type = 3
    posX = 3198
    posY = 2837
    face = 6
  STR_VAR
    dv = "IMOEN2"
    are = "AR0602"
    override_BG1 = "IMOEN_"
    override_SoA = "IMOEN2"
    override_ToB = "IMOEN25"
    dialog_ToB = "IMOEN25A"
    string = "@1"
END

//type of transition depends on if separate mod with type = 1 transition has been installed
ACTION_IF MOD_IS_INSTALLED ~NPCName/NPCName.tp2~ ~0~ BEGIN
  OUTER_SET type_var = 3 //this will change type of transition from 1 to 3
END ELSE BEGIN
  OUTER_SET type_var = 2 //BG1 version of NPC is not installed, so just add BG2 only transition
END
LAF ~EET_NPC_TRANSITION~
  INT_VAR
    type = type_var
    posX = 3198 //won't be used if type_var = 2
    posY = 2837 //won't be used if type_var = 2
    face = 6 //won't be used if type_var = 2
  STR_VAR
    dv = "IMOEN2"
    are = "AR0602"
    override_BG1 = "IMOEN_" //won't be used if type_var = 2
    override_SoA = "IMOEN2"
    override_ToB = "IMOEN25"
    dialog_ToB = "IMOEN25A"
    string = "@1"
END
</pre>
</div>

<p>You can see more examples in EET/lib/transition.tph file. It is preferable to use EET_TRANSITION than manually patching files. This way if anything regarding transition will be changed in future you won't need to edit your code but just replace TPH file with updated function declaration. For those interested how exactly it works or those who need to include additional REPLACE_TEXTUALLY patching within outcome code, here is an explanation what the function does:</p>
<ul>
<li><strong>K#TELBGT.BCS</strong> (SoD -> BG2 transition script) is expanded if type = 1 or 3:</li>
</ul>

<div class="important">
<pre>
IF
  Global("K#DoOnce%dv%","LOCALS",0)
  Global("%dv%PartyBG1","GLOBAL",1)
  !InMyArea("%dv%")
THEN
  RESPONSE #100
    MoveGlobalObjectOffScreen("%dv%",Player1)
    Continue()
END

IF
  Global("K#DoOnce%dv%","LOCALS",0)
  Global("%dv%PartyBG1","GLOBAL",1)
  InPartyAllowDead("%dv%")
THEN
  RESPONSE #100
    ActionOverride("%dv%",LeaveParty())
    Continue()
END

IF
  Global("K#DoOnce%dv%","LOCALS",0)
  Global("%dv%PartyBG1","GLOBAL",1)
  Dead("%dv%")
THEN
  RESPONSE #100
    SetGlobal("K#DoOnce%dv%","LOCALS",1)
    %reset_PartyBG1% //%dv%PartyBG1 and SPRITEISDEAD variables set to 0 if create_SoA = 1
    ActionOverride("%dv%",DropInventory())
    ActionOverride("%dv%",DestroySelf())
    Continue()
END

IF
  Global("K#DoOnce%dv%","LOCALS",0)
  Global("%dv%PartyBG1","GLOBAL",1)
  !Dead("%dv%")
THEN
  RESPONSE #100
    SetGlobal("K#DoOnce%dv%","LOCALS",1)
    ActionOverride("%dv%",DropInventory())
    ActionOverride("%dv%",ApplySpellRES("K#DISPEL",Myself))
    ActionOverride("%dv%",ChangeAIScript("",DEFAULT))
    ActionOverride("%dv%",ChangeEnemyAlly(Myself,NEUTRAL))
    ActionOverride("%dv%",MoveBetweenAreas("%are%",[%posX%.%posY%],%face%))
    ActionOverride("%dv%",ChangeAIScript("%transition_SoA%",OVERRIDE) //override_SoA used if not specified
    Continue()
END
</pre>
</div>

<ul>
<li><strong>BG1 and/or BG2 local script</strong> are extend top with this code, which will flag the NPC with variable detectable during ToB transition and disable NPC that should no longer exist after certain part of the story:</li>
</ul>

<div class="important">
<pre>
IF
  Global("ENDOFBG%game%","GLOBAL",0)
  Global("%dv%PartyBG%game%","GLOBAL",0)
  InParty(Myself)
THEN
  RESPONSE #100
    SetGlobal("%dv%PartyBG%game%","GLOBAL",1)
    Continue()
END

IF
  GlobalGT("ENDOFBG%game%","GLOBAL",0)
  Global("%dv%PartyBG%game%","GLOBAL",0)
THEN
  RESPONSE #100
    DestroySelf()
END
</pre>
</div>

<ul>
<li><strong>FATESP.DLG</strong> Fate Spirit summoning dialogue responses are expanded with following code:</li>
</ul>

<div class="important">
<pre>
  IF ~  Global("%SummonedVar%","GLOBAL",0)
Dead("%dv%")
~ THEN REPLY %string% DO ~SetGlobal("%SummonedVar%","GLOBAL",2)
~ GOTO 10
  IF ~  Global("%SummonedVar%","GLOBAL",0)
Global("%dv%PartyBG2","GLOBAL",0)
!Dead("%dv%")
~ THEN REPLY %string% DO ~SetGlobal("%SummonedVar%","GLOBAL",2)
~ GOTO 7
  IF ~  Global("%SummonedVar%","GLOBAL",0)
Global("%dv%PartyBG2","GLOBAL",1)
!Dead("%dv%")
~ THEN REPLY %string% DO ~SetGlobal("%SummonedVar%","GLOBAL",1)
~ GOTO 9
END
</pre>
</div>

<ul>
<li><strong>AR4000.BCS</strong> has additional code that will check if the NPC is currently in party or were at party at some point during BG1 and BG2. Setting %SummonedVar% to 2 removes NPC from Fate Spirit summon list. default_ToB set to 1 can be used to make NPC summonable by default in new game started in ToB expansion (in such case NEWGAME_TOB variable is set to 1) - this will REPLACE_TEXTUALLY first block in AR4000.BCS setting %dv%PartyBG2 variable to 1, which is not shown in below code.</li>
</ul>

<div class="important">
<pre>
IF
  InParty("%dv%")
  Global("%SummonedVar%","GLOBAL",0)
THEN
  RESPONSE #100
    SetGlobal("%SummonedVar%","GLOBAL",2)
END

IF
  Global("%SummonedVar%","GLOBAL",0)
  Global("%dv%PartyBG1","GLOBAL",0)
  Global("%dv%PartyBG2","GLOBAL",0)
THEN
  RESPONSE #100
    SetGlobal("%SummonedVar%","GLOBAL",2)
    Continue()
END
</pre>
</div>

<ul>
<li><strong>AR4500.BCS</strong> is extended bottom with the code that migrate NPC from BG2 area to Pocket Plane:</li>
</ul>

<div class="important">
<pre>
IF
  Global("NEWGAME_TOB","GLOBAL",0)
  Global("%SummonedVar%","GLOBAL",1)
  Global("%SpawnPlaneVar%","GLOBAL",0)
THEN
  RESPONSE #100
    CreateVisualEffect("SPPORTAL",[1999.1218])
    Wait(2)
    MoveGlobal("AR4500","%dv%",[1999.1218])
    ActionOverride("%dv%",Face(S))
    ActionOverride("%dv%",SetNumTimesTalkedTo(0))
    ActionOverride("%dv%",JoinParty())
    MoveToExpansion()
    SetGlobal("%SummonedVar%","GLOBAL",-1)
END

IF
  Global("NEWGAME_TOB","GLOBAL",0)
  Global("%SummonedVar%","GLOBAL",-1)
  Global("%SpawnPlaneVar%","GLOBAL",0)
  XPLT("%dv%",2500000)
THEN
  RESPONSE #100
    ActionOverride("%dv%",ChangeStat(Myself,XP,2500000,SET))
    Continue()
END

IF
  Global("NEWGAME_TOB","GLOBAL",0)
  Global("%SummonedVar%","GLOBAL",-1)
  Global("%SpawnPlaneVar%","GLOBAL",0)
THEN
  RESPONSE #100
    ActionOverride("%dv%",LeaveParty())
    ActionOverride("%dv%",SetBeenInPartyFlags())
    ActionOverride("%dv%",ChangeAIScript("%override_ToB%",OVERRIDE))
    ActionOverride("%dv%",SetDialog("%dialog_ToB%"))
    ActionOverride("%dv%",SetGlobal("KickedOut","LOCALS",0))
    SetGlobal("%SpawnPlaneVar%","GLOBAL",1)
    SetGlobal("%SummonedVar%","GLOBAL",1)
    Continue()
END
</pre>
</div>

<p>Depending on which variables you set in EET_TRANSITION code, different combination of above patching will take place.</p>

<p>If your mod changes BG2 plot to introduce Ajantis, Coran, Faldorn, Khalid, Safana, Tiax or Xzar as joinable NPCs in BG2 portion of the game than keep in mind that EET uses following code to properly set <a href="http://www.shsforums.net/topic/15817-dead-and-sprite-is-dead-varisbles/">SPRITEISDEAD variable</a> when BG2 version of them dies. Depending on how your mod is written you may need to clean changes made by EET in area scripts, implemented by this code:</p>

<div class="important">
<pre>
<<<<<<<< EET-inlined/SPRITEISDEAD-eb.baf
IF
  Global("K#Dead%dv_1%","%area%",0)
  OR(2)
    Dead("%dv%")
    StateCheck("%dv%",STATE_REALLY_DEAD)
THEN
  RESPONSE #100
    SetGlobal("K#Dead%dv_1%","%area%",1)
    SetGlobal("SPRITEISDEAD%dv_1%","GLOBAL",1)
    Continue()
END
>>>>>>>>

ACTION_DEFINE_ASSOCIATIVE_ARRAY table_bg2bcs_dvArea BEGIN
  palkni04 , Ajantis => AR1200
  c6coran , Coran => AR2600
  cefaldor , Faldorn => AR1901
  cefald01 , Faldorn => AR1901
  DeadKhalid , Khalid => AR0603
  c6safa , Safana => AR2600
  pptiax , Tiax => AR1515
  pptiax2 , Tiax => AR1515
  Lyros , Xzar => AR0300
END

ACTION_PHP_EACH table_bg2bcs_dvArea AS dv => area BEGIN
  EXTEND_BOTTOM ~%area%.BCS~ ~EET-inlined/SPRITEISDEAD-eb.baf~ EVALUATE_BUFFER
END
</pre>
</div>

<hr />
<a id="Workaround for PDIALOG.2DA forced dialogues" name="Workaround for PDIALOG.2DA forced dialogues"></a>
<h3>Workaround for PDIALOG.2DA forced dialogues</h3>
<p>Some mods adding BG1 NPCs to BG2, claims to be compatible with BGT, but uses different Death Variables (script names) through both games. There is no way to alter DV during transition, which means such mods must create new creatures for BG2 portion of the game, instead of providing continuity using existing BG1 files. I'm not quite sure why modders decides for such solution, but if it's related to PDIALOG.2DA that forces to use the same JOIN (main dialogue), POST and BANTER files, than I'd like to share a hint how to bypass this limitation:</p>

<ul>
<li><strong>Appending new dialogues to existing files</strong> - just add proper <a href="#Trigger filtering across BG1, SoD, BG2:SoA, BG2:ToB">trigger filtering</a> for your dialogues. This is the only known way to share BANTER dialogues although it can be also used for JOIN and POST files. In case you want to append BG2 dialogue files to vanilla BG1 dialogues consider using this code on the already existing dialogue file, which will automatically add ENDOFBG1 filtering to all relevant dialogue states:</li>
</ul>
<div class="important">
<pre>
COPY_EXISTING ~dialogName.DLG~ ~override~
  DECOMPILE_AND_PATCH BEGIN
    REPLACE_TEXTUALLY CASE_SENSITIVE ~\(^IF .*\)  ~ ~\1GlobalLT("ENDOFBG1","GLOBAL",2)
~
  END
BUT_ONLY
</pre>
</div>

<ul>
<li><strong>Use EET workaround to separate JOIN and POST dialogues between games</strong> - this eliminates potential problems with BG1 dialogues triggering in BG2 and other way around. Also less stress when it comes to mod compatibility. The end result is shorter and easier to analizę dialogue file. Paste this code at the beginning of NPC override script (either BG1 script if you are adding new unique BG2 dialogues, or other way around) to overwrite PDIALOG.2DA behaviour:</li>
</ul>
<div class="important">
<pre>
//true on save reload
IF
  OnCreation()
THEN
  RESPONSE #100
    SetGlobal("K#PDIALOG","LOCALS",0)
END

//overwrites PDIALOG.2DA JOIN dialogue file
IF
  Global("K#PDIALOG","LOCALS",0)
  InPartyAllowDead(Myself)
THEN
  RESPONSE #100
    SetDialog("JOINDLG")
    SetGlobal("K#PDIALOG","LOCALS",1)
    Continue()
END

//overwrites PDIALOG.2DA POST dialogue file
IF
  Global("K#PDIALOG","LOCALS",1)
  !InPartyAllowDead(Myself)
THEN
  RESPONSE #100
    SetDialog("POSTDLG")
    SetGlobal("K#PDIALOG","LOCALS",0)
    Continue()
END
</pre>
</div>

<p>If you are using the same override script in BG1 and BG2 than you should add ENDOFBG1 filtering to above code. Remember that you can also use SetDialog to assign new starting dialogue when the NPC is first met in BG2 portion of the game and ChangeAIScript to overwrite any local script currently assign to the NPC.</p>

<hr />
<a id="Workaround for CalanderDay command in SoD/BG2 portion of the game" name="Workaround for CalanderDay command in SoD/BG2 portion of the game"></a>
<h3>Workaround for CalanderDay command in SoD/BG2 portion of the game</h3>
<p>CalanderDay(I:Day*) / CalanderDayGT(I:Day*) / CalanderDayLT(I:Day*) triggers can be used to detect if the current day is the day specified / after the day specified / before the day specified. What about situations when you need to use it in Siege of Dragonspear or Baldur's Gate 2 portion of the game? We don't know how many days it will take CHARNAME party to finish first 7 chapters, so the vanilla command becomes less useful. That is why EET introduced days counter that can be used as a workaround here. For easier explanation let's take a look at how EET resolved this problem for Town Crier in Athkatla, who should tell something new each 3 passing days.

<p>Town Crier local script (DS3483.BCS) has been expanded with the below code that assigns K#TOWNC01_day variable to use K#DaysPassed value (in EET this variable counts passed in-game days). From now after each day the value of K#TOWNC01_cnt will be increased by 1. You don't need to be near NPC to make it work - the K#TOWNC01_cnt variable will be updated correctly as soon as you return to area with this NPC.</p>
<div class="important">
<pre>
IF
  Global("K#DoOnce","LOCALS",0)
  Global("K#TOWNC01_cnt","GLOBAL",0)
THEN
  RESPONSE #100
    SetGlobal("K#DoOnce","LOCALS",1)
    SetGlobal("K#TOWNC01_cnt","GLOBAL",1) //modify this value if you want to change starting day
    SetGlobal("K#TOWNC01_day","GLOBAL",0) //just to be sure
    AddGlobals("K#TOWNC01_day","K#DaysPassed")
    Continue()
END

IF
  Global("K#DoOnce","LOCALS",1)
  GlobalsGT("K#DaysPassed","K#TOWNC01_day")
THEN
  RESPONSE #100
    IncrementGlobal("K#TOWNC01_cnt","GLOBAL",1)
    IncrementGlobal("K#TOWNC01_day","GLOBAL",1)
    Continue()
END
</pre>
</div>

<p>Now that we have a working day tracking system we should modify TOWNC01.DLG to replace CalanderDayLT trigger with variable check instead, like this:</p>
<div class="important">
<pre>
COPY_EXISTING ~TOWNC01.DLG~ ~override~
  DECOMPILE_AND_PATCH BEGIN
    REPLACE_TEXTUALLY ~CalanderDayLT(~ ~GlobalLT("K#TOWNC01_cnt","GLOBAL",~
  END
BUT_ONLY
</pre>
</div>
<p>There you go - a working workaround for CalanderDayLT. You can adjust the code to easily create workarounds for CalanderDay and CalanderDayGT too. In this example K#TOWNC01_cnt is a GLOBAL variable due to multiple instances of TOWNC01.CRE in different areas and we want them all to use the same days passed counter. You can change it to use LOCALS variable instead if the counter should be tracked only for 1 instance of NPC.</p>

<hr />
<a id="Adding new animations" name="Adding new animations"></a>
<h3>Adding new animations</h3>
<p>Unlike classic games Infinity Engine distributed with Enhanced Edition games doesn't have hardcoded limit for animations, so assigning new animations to existing vanilla slots is considered a bad practice now. There are 2 ways to implement new animations to the game:</p>
<ul>
<li><strong>INI files</strong> - engine feature introduced in IWD:EE and BG2:EE (patch 1.3). INI files, named afer the offset used for particular animation, contains code that was previously hardcoded within EXE file. Unfortunately they are not documented on <a href="http://gemrb.org/iesdp/main.htm">IESDP</a> yet, but many options available are pretty self-explanatory. EET distributes INI files from IWD:EE that cover all vanilla BG:EE and BG2:EE animations (you can get INI files for animations added by IWD:EE if you install separate mod called IWD-in-EET). Please refer to them for example usage. Probably the most interesting thing about them is optional "new_palette=" entry under [general] section that allows us to assign external palette BMP files that will be used with animation, which means there is no point in distributing animation with mod if it's just a re-palleted version of existing one - INI file with new offset and palette reference will do the job.</li>
<li><strong>EXTANIM.2DA, EXTSPEED.2DA</strong> - alternative to above implementation and another engine feature introduced by Beamdog. Hopefully <a href="http://gemrb.org/iesdp/main.htm">IESDP</a> will have full documentation for these files at some point. For now refer to what has been said by Scott Brooks in <a href="https://forums.beamdog.com/discussion/comment/116705#Comment_116705">this topic</a>. Example code can be found in viader's <a href="https://forums.beamdog.com/discussion/19501/resource-pack-extended-animations/p1">Extended Animations</a> mod.</li>
</ul>
<p>EET promotes common standard introduced in IWD:EE and viader's Extended Animations mod. If you are creating mod compatible with EET you should follow what has been said by viader regarding animation slot offsets, in above mentioned topic:</p>
<div class="important">
<pre>
0xE240 - 0xE2FF - reserved by Extended Animations
0xE330 - 0xE3FF - free
0xE440 - 0xE4FF - free
0xE530 - 0xE5FF - free
0xE620 - 0xE6FF - free
0xE730 - 0xE7FF - free
0xE850 - 0xE8FF - free
0xE920 - 0xE9FF - free
0xEA30 - 0xEAFF - free
0xEB30 - 0xEBFF - free
0xEC30 - 0xECFF - free
0xED30 - 0xEDFF - free
0xEE20 - 0xEEFF - free
</pre>
</div>

<hr />
<a id="Adding support for EET Worldmap" name="Adding support for EET Worldmap"></a>
<h3>Adding support for EET Worldmap</h3>
<p>EET Worldmap consists of BG1, BG2, ToB maps merged together (after SoD release it will be expanded to also cover land added by this expansion). Thanks to such implementation it's easy to add new areas to it, sharing the same code as BG1/Tutu worldmap (BG:EE one uses a little different coordinates for icons), BG2/BG2:EE and ToB worldmaps. For EET you can use the same coordinates as in vanilla maps but with added X and Y correction that represents where the old map starts compared to the upper-left corner of the EET map. Preferable way of doing so is using <a href="../other/cpmvars">cpmvars variable libraries</a> (this way updating X/Y coordinate correction after EET Worldmap is expanded will be a matter of replacing an external file). BG1 and ToB icons have been appended to MAPICONS.BAM file, so you also need to take it into account. EET uses the same icon numbers as BP-BGT Worldmap.

<p>Here is an example code that is compatible with different platforms at the same time:</p>

<div class="important">
<pre>
//either use cpmvars that have these variables set or add this variable declaration somewhere in your tp2 code
ACTION_IF GAME_IS ~eet~ BEGIN
  OUTER_SET wmp_xCoord_BG1 = 373 //in relation to BG1/Tutu WORLDMAP.WMP add 373 px correction to X coordinate
  OUTER_SET wmp_yCoord_BG1 = 0 //in relation to BG1/Tutu WORLDMAP.WMP add 0 px correction to Y coordinate
  OUTER_SET wmp_xCoord_SoA = 0 //in relation to BG2/BG2:EE WORLDMAP.WMP add 0 px correction to X coordinate
  OUTER_SET wmp_yCoord_SoA = 953 //in relation to BG2/BG2:EE WORLDMAP.WMP add 953 px correction to Y coordinate
  OUTER_SET wmp_xCoord_ToB = 893 //in relation to BG2/BG2:EE WORLDM25.WMP add 893 px correction to X coordinate
  OUTER_SET wmp_yCoord_ToB = 1681 //in relation to BG2/BG2:EE WORLDM25.WMP add 1681 px correction to Y coordinate
  OUTER_SET wmp_mapIcon_BG1 = 29 //in relation to Tutu YAC22MAP.BAM add 29 cycles correction to map icon
  OUTER_SET wmp_mapIcon_ToB = 85 //in relation to BG2 25MAPIC.BAM add 85 cycles correction to map icon
  OUTER_SPRINT wmp_worldmap_ToB "worldmap" //when editing ToB worldmap use WORLDMAP.WMP instead of WORLDM25.WMP
END ELSE BEGIN
  OUTER_SET wmp_xCoord_BG1 = 0
  OUTER_SET wmp_yCoord_BG1 = 0
  OUTER_SET wmp_xCoord_SoA = 0
  OUTER_SET wmp_yCoord_SoA = 0
  OUTER_SET wmp_xCoord_ToB = 0
  OUTER_SET wmp_yCoord_ToB = 0
  OUTER_SET wmp_mapIcon_BG1 = 0
  OUTER_SET wmp_mapIcon_ToB = 0
  OUTER_SPRINT wmp_worldmap_ToB "worldm25"
END

//example code that adds new area to BG1/Tutu/EET WORLDMAP.WMP
LAF sc#addWmpAre
  INT_VAR
    mapIcon = 5 + wmp_mapIcon_BG1
    xCoord = 240 + wmp_xCoord_BG1
    yCoord = 130 + wmp_yCoord_BG1
  STR_VAR
    areName = ~fileName~
    strName = "nameOfTheArea"
    strDesc = "nameOfTheArea"
END

//example code that adds new area to BG2/BG2:EE/EET WORLDMAP.WMP
LAF sc#addWmpAre
  INT_VAR
    mapIcon = 5
    xCoord = 240 + wmp_xCoord_SoA
    yCoord = 130 + wmp_yCoord_SoA
  STR_VAR
    areName = ~fileName~
    strName = "nameOfTheArea"
    strDesc = "nameOfTheArea"
END

//example code that adds new area to BG2/BG2:EE WORLDM25.WMP and to EET WORLDMAP.WMP
LAF sc#addWmpAre
  INT_VAR
    mapIcon = 5 + wmp_mapIcon_ToB
    xCoord = 240 + wmp_xCoord_ToB
    yCoord = 130 + wmp_yCoord_ToB
  STR_VAR
    areName = ~fileName~
    strName = "nameOfTheArea"
    strDesc = "nameOfTheArea"
    worldmap = EVAL "%wmp_worldmap_ToB%"
END
</pre>
</div>

<p>For reference here is a table listing all icons available in EET MAPICONS.BAM file and icon numbers used by EET and other platforms.</p>

<table class="tg" style="undefined;table-layout: auto; width: 90%">
 <colgroup>
   <col style="width: 20%">
   <col style="width: 10%">
   <col style="width: 10%">
   <col style="width: 10%">
   <col style="width: 10%">
 </colgroup>
 <tr>
  <th class="tg">Icon</th>
  <th class="tg">EET / BP-BGT Worldmap</th>
  <th class="tg">Tutu</th>
  <th class="tg">BG2 / BG2:EE (SoA map)</th>
  <th class="tg">BG2 / BG2:EE (ToB map)</th>
 </tr>
 <tr>
  <td class="tg"><img width=92 height=98 id="Image 0" src="images/image001.png"></td>
  <td class="tg">5</td>
  <td class="tg">-</td>
  <td class="tg">5</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=72 height=112 id="Image 1" src="images/image002.png"></td>
  <td class="tg">6</td>
  <td class="tg">-</td>
  <td class="tg">6</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=69 height=78 id="Image 2" src="images/image003.png"></td>
  <td class="tg">7</td>
  <td class="tg">-</td>
  <td class="tg">7</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=54 height=80 id="Image 3" src="images/image004.png"></td>
  <td class="tg">8</td>
  <td class="tg">-</td>
  <td class="tg">8</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=73 height=50 id="Image 4" src="images/image005.png"></td>
  <td class="tg">9</td>
  <td class="tg">-</td>
  <td class="tg">9</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=63 height=48 id="Image 5" src="images/image006.png"></td>
  <td class="tg">10</td>
  <td class="tg">-</td>
  <td class="tg">10</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=48 height=68 id="Image 6" src="images/image007.png"></td>
  <td class="tg">11</td>
  <td class="tg">-</td>
  <td class="tg">11</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=70 height=55 id="Image 7" src="images/image008.png"></td>
  <td class="tg">12</td>
  <td class="tg">-</td>
  <td class="tg">12</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=66 height=50 id="Image 8" src="images/image009.png"></td>
  <td class="tg">13</td>
  <td class="tg">-</td>
  <td class="tg">13</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=59 height=44 id="Image 9" src="images/image010.png"></td>
  <td class="tg">14</td>
  <td class="tg">-</td>
  <td class="tg">14</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=87 height=73 id="Image 10" src="images/image011.png"></td>
  <td class="tg">15</td>
  <td class="tg">-</td>
  <td class="tg">15</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=66 height=66 id="Image 11" src="images/image012.png"></td>
  <td class="tg">16</td>
  <td class="tg">-</td>
  <td class="tg">16</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=80 height=60 id="Image 12" src="images/image013.png"></td>
  <td class="tg">17</td>
  <td class="tg">-</td>
  <td class="tg">17</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=81 height=83 id="Image 13" src="images/image014.png"></td>
  <td class="tg">18</td>
  <td class="tg">-</td>
  <td class="tg">18</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=85 height=86 id="Image 14" src="images/image015.png"></td>
  <td class="tg">19</td>
  <td class="tg">-</td>
  <td class="tg">19</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=83 height=82 id="Image 15" src="images/image016.png"></td>
  <td class="tg">20</td>
  <td class="tg">-</td>
  <td class="tg">20</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=73 height=71 id="Image 16" src="images/image017.png"></td>
  <td class="tg">21</td>
  <td class="tg">-</td>
  <td class="tg">21</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=70 height=67 id="Image 17" src="images/image018.png"></td>
  <td class="tg">22</td>
  <td class="tg">-</td>
  <td class="tg">22</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=87 height=82 id="Image 18" src="images/image019.png"></td>
  <td class="tg">23</td>
  <td class="tg">-</td>
  <td class="tg">23</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=76 height=73 id="Image 19" src="images/image020.png"></td>
  <td class="tg">24</td>
  <td class="tg">-</td>
  <td class="tg">24</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=79 height=74 id="Image 20" src="images/image021.png"></td>
  <td class="tg">25</td>
  <td class="tg">-</td>
  <td class="tg">25</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=53 height=52 id="Image 21" src="images/image022.png"></td>
  <td class="tg">26</td>
  <td class="tg">-</td>
  <td class="tg">26</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=50 height=60 id="Image 22" src="images/image023.png"></td>
  <td class="tg">28</td>
  <td class="tg">-</td>
  <td class="tg">28</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=111 height=90 id="Image 23" src="images/image024.png"></td>
  <td class="tg">29</td>
  <td class="tg">0</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=99 height=85 id="Image 24" src="images/image025.png"></td>
  <td class="tg">30</td>
  <td class="tg">1</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=98 height=82 id="Image 25" src="images/image026.png"></td>
  <td class="tg">31</td>
  <td class="tg">2</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=104 height=95 id="Image 26" src="images/image027.png"></td>
  <td class="tg">32</td>
  <td class="tg">3</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=126 height=72 id="Image 27" src="images/image028.png"></td>
  <td class="tg">33</td>
  <td class="tg">4</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=80 height=80 id="Image 28" src="images/image029.png"></td>
  <td class="tg">34</td>
  <td class="tg">5</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=100 height=83 id="Image 29" src="images/image030.png"></td>
  <td class="tg">35</td>
  <td class="tg">6</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=118 height=100 id="Image 30" src="images/image031.png"></td>
  <td class="tg">36</td>
  <td class="tg">7</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=100 height=84 id="Image 31" src="images/image032.png"></td>
  <td class="tg">37</td>
  <td class="tg">8</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=64 height=50 id="Image 32" src="images/image033.png"></td>
  <td class="tg">38</td>
  <td class="tg">9</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=77 height=47 id="Image 33" src="images/image034.png"></td>
  <td class="tg">39</td>
  <td class="tg">10</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=71 height=53 id="Image 34" src="images/image035.png"></td>
  <td class="tg">40</td>
  <td class="tg">11</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=72 height=52 id="Image 35" src="images/image036.png"></td>
  <td class="tg">41</td>
  <td class="tg">12</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=67 height=45 id="Image 36" src="images/image037.png"></td>
  <td class="tg">42</td>
  <td class="tg">13</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=88 height=66 id="Image 37" src="images/image038.png"></td>
  <td class="tg">43</td>
  <td class="tg">14</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=70 height=54 id="Image 38" src="images/image039.png"></td>
  <td class="tg">44</td>
  <td class="tg">15</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=69 height=56 id="Image 39" src="images/image040.png"></td>
  <td class="tg">45</td>
  <td class="tg">16</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=89 height=73 id="Image 40" src="images/image041.png"></td>
  <td class="tg">46</td>
  <td class="tg">17</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=81 height=62 id="Image 41" src="images/image042.png"></td>
  <td class="tg">47</td>
  <td class="tg">18</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=79 height=61 id="Image 42" src="images/image043.png"></td>
  <td class="tg">48</td>
  <td class="tg">19</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=81 height=50 id="Image 43" src="images/image044.png"></td>
  <td class="tg">49</td>
  <td class="tg">20</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=91 height=67 id="Image 44" src="images/image045.png"></td>
  <td class="tg">50</td>
  <td class="tg">21</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=77 height=45 id="Image 45" src="images/image046.png"></td>
  <td class="tg">51</td>
  <td class="tg">22</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=48 id="Image 46" src="images/image047.png"></td>
  <td class="tg">52</td>
  <td class="tg">23</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=89 height=66 id="Image 47" src="images/image048.png"></td>
  <td class="tg">53</td>
  <td class="tg">24</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=72 height=56 id="Image 48" src="images/image049.png"></td>
  <td class="tg">54</td>
  <td class="tg">25</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=80 height=57 id="Image 49" src="images/image050.png"></td>
  <td class="tg">56</td>
  <td class="tg">26</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=58 height=58 id="Image 50" src="images/image051.png"></td>
  <td class="tg">57</td>
  <td class="tg">27</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=73 height=52 id="Image 51" src="images/image052.png"></td>
  <td class="tg">58</td>
  <td class="tg">28</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=73 height=56 id="Image 52" src="images/image053.png"></td>
  <td class="tg">59</td>
  <td class="tg">29</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=81 height=48 id="Image 53" src="images/image054.png"></td>
  <td class="tg">61</td>
  <td class="tg">30</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=68 height=58 id="Image 54" src="images/image055.png"></td>
  <td class="tg">62</td>
  <td class="tg">31</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=79 height=54 id="Image 55" src="images/image056.png"></td>
  <td class="tg">63</td>
  <td class="tg">32</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=85 height=57 id="Image 56" src="images/image057.png"></td>
  <td class="tg">64</td>
  <td class="tg">33</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=79 height=51 id="Image 57" src="images/image058.png"></td>
  <td class="tg">65</td>
  <td class="tg">34</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=44 id="Image 58" src="images/image059.png"></td>
  <td class="tg">66</td>
  <td class="tg">35</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=82 height=69 id="Image 59" src="images/image060.png"></td>
  <td class="tg">67</td>
  <td class="tg">36</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=83 height=47 id="Image 60" src="images/image061.png"></td>
  <td class="tg">68</td>
  <td class="tg">37</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=51 id="Image 61" src="images/image062.png"></td>
  <td class="tg">69</td>
  <td class="tg">38</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=63 height=57 id="Image 62" src="images/image063.png"></td>
  <td class="tg">70</td>
  <td class="tg">39</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=77 height=75 id="Image 63" src="images/image064.png"></td>
  <td class="tg">71</td>
  <td class="tg">40</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=87 height=69 id="Image 64" src="images/image065.png"></td>
  <td class="tg">72</td>
  <td class="tg">41</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=55 id="Image 65" src="images/image066.png"></td>
  <td class="tg">73</td>
  <td class="tg">42</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=65 height=48 id="Image 66" src="images/image067.png"></td>
  <td class="tg">74</td>
  <td class="tg">43</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=82 height=55 id="Image 67" src="images/image068.png"></td>
  <td class="tg">75</td>
  <td class="tg">44</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=77 height=62 id="Image 68" src="images/image069.png"></td>
  <td class="tg">76</td>
  <td class="tg">45</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=80 height=61 id="Image 69" src="images/image070.png"></td>
  <td class="tg">77</td>
  <td class="tg">46</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=83 height=54 id="Image 70" src="images/image071.png"></td>
  <td class="tg">78</td>
  <td class="tg">47</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=69 height=55 id="Image 71" src="images/image072.png"></td>
  <td class="tg">79</td>
  <td class="tg">48</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=67 height=61 id="Image 72" src="images/image073.png"></td>
  <td class="tg">80</td>
  <td class="tg">49</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=97 height=75 id="Image 73" src="images/image074.png"></td>
  <td class="tg">82</td>
  <td class="tg">50</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=51 id="Image 74" src="images/image075.png"></td>
  <td class="tg">83</td>
  <td class="tg">51</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=82 height=74 id="Image 75" src="images/image076.png"></td>
  <td class="tg">84</td>
  <td class="tg">52</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=50 height=60 id="Image 76" src="images/image077.png"></td>
  <td class="tg">90</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">5</td>
 </tr>
 <tr>
  <td class="tg"><img width=51 height=49 id="Image 77" src="images/image078.png"></td>
  <td class="tg">91</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">6</td>
 </tr>
 <tr>
  <td class="tg"><img width=56 height=54 id="Image 78" src="images/image079.png"></td>
  <td class="tg">92</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">7</td>
 </tr>
 <tr>
  <td class="tg"><img width=51 height=58 id="Image 79" src="images/image080.png"></td>
  <td class="tg">93</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">8</td>
 </tr>
 <tr>
  <td class="tg"><img width=58 height=58 id="Image 80" src="images/image081.png"></td>
  <td class="tg">94</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">9</td>
 </tr>
 <tr>
  <td class="tg"><img width=52 height=52 id="Image 81" src="images/image082.png"></td>
  <td class="tg">95</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">10</td>
 </tr>
 <tr>
  <td class="tg"><img width=56 height=55 id="Image 82" src="images/image083.png"></td>
  <td class="tg">96</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">11</td>
 </tr>
 <tr>
  <td class="tg"><img width=59 height=61 id="Image 83" src="images/image084.png"></td>
  <td class="tg">97</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">12</td>
 </tr>
 <tr>
  <td class="tg"><img width=51 height=57 id="Image 84" src="images/image085.png"></td>
  <td class="tg">98</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">13</td>
 </tr>
 <tr>
  <td class="tg"><img width=59 height=55 id="Image 85" src="images/image086.png"></td>
  <td class="tg">99</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">14</td>
 </tr>
 <tr>
  <td class="tg"><img width=57 height=58 id="Image 86" src="images/image087.png"></td>
  <td class="tg">100</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">15</td>
 </tr>
 <tr>
  <td class="tg"><img width=54 height=62 id="Image 87" src="images/image088.png"></td>
  <td class="tg">101</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">16</td>
 </tr>
 <tr>
  <td class="tg"><img width=51 height=55 id="Image 88" src="images/image089.png"></td>
  <td class="tg">102</td>
  <td class="tg">-</td>
  <td class="tg">-</td>
  <td class="tg">17</td>
 </tr>
 <tr>
  <td class="tg"><img width=75 height=79 id="Image 89" src="images/image090.png"></td>
  <td class="tg">106</td>
  <td class="tg">-</td>
  <td class="tg">29 (only in BG2:EE)</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=77 height=75 id="Image 90" src="images/image091.png"></td>
  <td class="tg">107</td>
  <td class="tg">-</td>
  <td class="tg">31 (only in BG2:EE)</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=69 id="Image 91" src="images/image092.png"></td>
  <td class="tg">108</td>
  <td class="tg">-</td>
  <td class="tg">32 (only in BG2:EE)</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=77 height=69 id="Image 92" src="images/image093.png"></td>
  <td class="tg">109</td>
  <td class="tg">-</td>
  <td class="tg">33 (only in BG2:EE)</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=78 height=67 id="Image 93" src="images/image094.png"></td>
  <td class="tg">110</td>
  <td class="tg">-</td>
  <td class="tg">34 (only in BG2:EE)</td>
  <td class="tg">-</td>
 </tr>
 <tr>
  <td class="tg"><img width=79 height=80 id="Image 94" src="images/image095.png"></td>
  <td class="tg">111</td>
  <td class="tg">-</td>
  <td class="tg">30 (only in BG2:EE)</td>
  <td class="tg">18 (only in BG2:EE)</td>
 </tr>
</table>

<table class="tg" style="undefined;table-layout: auto; width: 90%">
 <tr>
  <td><strong>EET Worldmap area references</strong> (click to enlarge)</td>
 </tr>
 <tr>
   <td class="tg"><a href="images/EET_worldmap.png"><img width=100% height=100% id="EET_worldmap" src="images/EET_worldmap.png"></a></td>
 </tr>
</table>

<address><span class="footer">DEV > Creating mods for EET</span> ·<a href="#top">BACK TO TOP</a></address>
</div>
<!-- ================== C h a n g e s ================== --><a id="changes" name="changes"></a>

<div class="content">
<h2>List of changes in vanilla files</h2>
<p>Not done yet, this section will be finished after Siege of Dragonspear become fully compatible with EET. Don't worry about it all that much. The changes are relatively minor and not intrusive, so as long as you followed what has been said in previous sections of developer's documentation, chance that EET will brake your mod is close to 0.</p>

<address><span class="footer">DEV > List of changes in vanilla files</span> ·<a href="#top">BACK TO TOP</a></address>
</div>
<!-- ================== R e s o u r c e s ================== --><a id="resources" name="resources"></a>

<div class="content">
<h2>New resources</h2>
<p></p>

<ul>
	<li><a href="../base/2da">CRIPPSTR.2DA, SNEAKATT.2DA</a> - 2da files imported from IWD:EE. Patch 1.3 for BG2:EE backported new features from IWD:EE release. These particular files are used for Thief sneak attack/crippling strike mechanics known from IWD and 3rd edition of pen-and-paper Dungeon & Dragons ruleset. They work exactly the same as in IWD:EE and replaces Backstabbing. To fully enable this mechanics in your game install "3E Thief Sneak Attack" <a href="https://github.com/K4thos/EET_Tweaks">EET Tweaks</a> component.</li>
	<li><a href="../base/chr">Creature files</a> - dummy invisible creatures with local scripts attached. Used for various things like setting dynamic biography (K#BIO.CRE), applying penalties after familiar is killed (K#FAMKIL.CRE), removing familiars and bonuses (K#FAMREM.CRE), summoning and assigning familiar based on Player1 allegiance (K#FAMSUM.CRE), iron crisis during BG1 implementation for different items (K#SHATAR.CRE, K#SHATHE.CRE, K#SHATSH.CRE, K#SHATWE.CRE), skipping the BG1 game and moving right into BG2 (K#TELBG2.CRE), SoD -> BG2 transition script (K#TELBGT.CRE), starting tutorial (K#TELTUT.CRE).</li>
	<li><a href="../base/eff">Effect files</a> - same names as dummy creatures, part of the implementation of above mentioned features.</li>
	<li><a href="../base/gui">GUI graphic</a> - mostly BAM, PVRZ, MBC (packed MOS) and some other files related to EET GUI elements</li>
	<li><a href="../base/ini">INI files</a> - another new feature back-ported by Beamdog from IWD:EE to BG2:EE engine but without providing files to make it work. These INI files, named after animation offsets, covers every single animation in game and allows to mod some additional features that are normally hardcoded within EXE file.</li>
	<li><a href="../base/itm">Item files</a> - once again the same names as dummy creatures - part of EET features implementation.</li>
	<li><a href="../base/lmovies">Silent movies</a> - to save space there is one version of dubbed movies. Audio is added on the fly during installation using ogg tracks stored within lang directory</li>
	<li><a href="../base/movies">Movies</a> - for better consistency with BG2 movies EET comes with original BG1 movies converted to HD and WEBM format</li>
	<li><a href="../base/spl">Spells</a> - spells used for various things related to EET features: fully restoring CRE (K#CURE.SPL), killing CRE (K#DEATH.SPL), dispelling magic effects (K#DISPEL.SPL), free action (K#FREEA.SPL), resurrecting CRE (K#LIVE.SPL), assigning new portrait (K#PORTR.SPL), removing Bhaal Powers (K#REMBHA.SPL), removing particular spells (K#REMSPL.SPL, edited during installation), summoning dummy CRE (K#FAMKIL.SPL, K#SHAT.SPL), silencing CRE (K#SILENC.SPL), and 2 replaced vanilla spells related to Find Familiar mechanics (SPCL342.SPL, SPWI123.SPL)</li>
	<li><a href="../base/tbc">TIS files</a> - fix for 2 TIS files that becomes corrupted after using tis2bg2 tool</li>
	<li><a href="../base/wed">WED files</a> - fix for 2 WED files that becomes corrupted after using tis2bg2 tool</li>
</ul>

<address><span class="footer">DEV > New resources</span> ·<a href="#top">BACK TO TOP</a></address>
</div>
<!-- ================== V e r s i o n   H i s t o r y ================== --><a id="version" name="version"></a>

<div class="content">
<h2>Version history</h2>

<p><a href="#" onclick="toggle('1.0'); return false;">Expand/Collapse All</a></p>

<h6><a href="#" onclick="toggle('1.0'); return false;">Version 1.0 (no date yet)</a></h6>

<ul class="vlisthide" id="1.0">
	<li>First public release</li>
</ul>

<address><span class="footer">DEV > Version History</span> ·<a href="#top">BACK TO TOP</a></address>
</div>
</div>
</div>
<number><script type="text/javascript">
    <!--
      function toggle(id) {
        element = document.getElementById(id);
        if ( element.style.display == 'none' ) {
          element.style.display = '';
          if ( document.all ) {
            document.getElementById('vhistoryaddress').style.display = 'none'; // IE hack
          }
        } else {
          element.style.display = 'none';
          if ( document.all ) {
            document.getElementById('vhistoryaddress').style.display = ''; // IE hack
          }
        }
      }

      elements = document.getElementsByTagName('*');
      for ( var i = 0; i < elements.length; i++ ) {
        if ( elements[i].className == 'vlisthide' ) {
          elements[i].style.display = 'none';
        }
      }
    //-->
    </script></number></body>
</html>
